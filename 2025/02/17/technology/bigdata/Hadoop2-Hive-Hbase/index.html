<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Sabthever">
    
    <!-- Completely eliminate flash of wrong theme -->
    <script>
        (function() {
            const THEME_KEY = "REDEFINE-THEME-STATUS";
            const DARK = "dark", LIGHT = "light";
            
            // Get preferred theme
            function getTheme() {
                try {
                    const saved = localStorage.getItem(THEME_KEY);
                    if (saved) {
                        const { isDark } = JSON.parse(saved);
                        return isDark ? DARK : LIGHT;
                    }
                } catch (e) {}
                
                return matchMedia("(prefers-color-scheme: dark)").matches ? DARK : LIGHT;
            }
            
            // Apply theme to document
            function applyTheme(theme) {
                const isDark = theme === DARK;
                const root = document.documentElement;
                
                // Set classes for compatibility
                root.classList.add(theme);
                root.classList.remove(isDark ? LIGHT : DARK);
                root.style.colorScheme = theme;
            }
            
            // Initial application
            const theme = getTheme();
            applyTheme(theme);
            
            // Listen for system preference changes
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", ({ matches }) => {
                // Only update if using system preference (no localStorage entry)
                if (!localStorage.getItem(THEME_KEY)) {
                    applyTheme(matches ? DARK : LIGHT);
                }
            });
            
            // Set body classes ASAP (before DOMContentLoaded)
            (function() {
                const addBodyClass = () => {
                    const b = document.body;
                    if (!b) return false;
                    b.classList.add(theme + "-mode");
                    return true;
                };

                // Try immediately
                if (addBodyClass()) return;

                // Observe until body exists
                const mo = new MutationObserver(() => {
                    if (addBodyClass()) mo.disconnect();
                });
                mo.observe(document.documentElement, { childList: true, subtree: true });
            })();
        })();
    </script>
    
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://sabthever.cn/2025/02/17/technology/bigdata/hadoop2-hive-hbase/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据学习笔记2-Hive、Hbase">
<meta property="og:url" content="https://sabthever.cn/2025/02/17/technology/bigdata/Hadoop2-Hive-Hbase/index.html">
<meta property="og:site_name" content="Sabthever&#39;s Blog">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sabthever.cn/images/redefine-og.webp">
<meta property="article:published_time" content="2025-02-17T02:39:34.000Z">
<meta property="article:modified_time" content="2025-10-09T08:14:31.628Z">
<meta property="article:author" content="Sabthever">
<meta property="article:tag" content="Hadoop">
<meta property="article:tag" content="Hive">
<meta property="article:tag" content="Hbase">
<meta property="article:tag" content="Bigdata">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sabthever.cn/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/%E5%A4%B4%E5%83%8F.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/%E5%A4%B4%E5%83%8F.jpg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/%E5%A4%B4%E5%83%8F.jpg">
    <!--- Page Info-->
    
    <title>
        
            大数据学习笔记2-Hive、Hbase | Sabthever&#39;s Blog
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"sabthever.cn","root":"/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":false},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":true,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"side_tools":{"gear_rotation":true,"auto_expand":true},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Wecome to my blog!","subtitle":{"text":["Loading..."],"hitokoto":{"enable":true,"show_author":true,"api":"https://v1.hitokoto.cn?encode=utf-8&c=d&c=h&c=i&c=k&c=e"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":3000,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/Sabthever","instagram":null,"zhihu":null,"twitter":null,"email":"3175693234@qq.com"},"qrs":{"weixin":null,"fa-brands fa-qq":"/images/qq.jpg"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"},"mindmap":{"enable":true}},"version":"2.8.5","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-solid fa-house"},"说说":{"path":"/essays","icon":"fa-solid fa-message-dots"},"Archives":{"path":"/archives","icon":"fa-solid fa-archive"},"书签":{"icon":"fa-solid fa-bookmark","path":"/bookmarks/"},"相册":{"icon":"fa-solid fa-image","path":"/masonry/"},"About":{"icon":"fa-solid fa-user","path":"/about"}},"search":{"enable":true,"preload":true,"path":"search.xml","field":"post","content":true,"format":"html"}},"page_templates":{"friends_column":3,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"info","announcement":"域名变更。从即日起域名变更为https://www.sabthever.cn/ ，这个域名后期会长期使用。原域名https://www.sabthever.online/将会维护到2025-12-25，请保存新的地址。","show_on_mobile":true,"links":{"说说":{"icon":"fa-solid fa-message-dots","path":"/essays"},"书签":{"icon":"fa-solid fa-bookmark","path":"/bookmarks/"},"相册":{"icon":"fa-solid fa-image","path":"/masonry/"},"关于":{"icon":"fa-solid fa-user","path":"/about"}}},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2024/12/18 15:27:14"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.3.0"></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Sabthever&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-solid fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/essays"
                                        >
                                    <i class="fa-solid fa-message-dots fa-fw"></i>
                                    说说
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-solid fa-archive fa-fw"></i>
                                    归档
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/bookmarks/"
                                        >
                                    <i class="fa-solid fa-bookmark fa-fw"></i>
                                    书签
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/masonry/"
                                        >
                                    <i class="fa-solid fa-image fa-fw"></i>
                                    相册
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/about"
                                        >
                                    <i class="fa-solid fa-user fa-fw"></i>
                                    关于
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-solid fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/essays"
                        >
                            <span>
                                说说
                            </span>
                            
                                <i class="fa-solid fa-message-dots fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                归档
                            </span>
                            
                                <i class="fa-solid fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/bookmarks/"
                        >
                            <span>
                                书签
                            </span>
                            
                                <i class="fa-solid fa-bookmark fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/masonry/"
                        >
                            <span>
                                相册
                            </span>
                            
                                <i class="fa-solid fa-image fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/about"
                        >
                            <span>
                                关于
                            </span>
                            
                                <i class="fa-solid fa-user fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
                
                    
                    
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/about"
                        >
                            <span>关于</span>
                            <i class="fa-solid fa-user fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">39</div>
        <div class="label text-third-text-color text-sm">标签</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">7</div>
        <div class="label text-third-text-color text-sm">分类</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">38</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">大数据学习笔记2-Hive、Hbase</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/%E5%A4%B4%E5%83%8F.jpg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">Sabthever</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-02-17 10:39:34</span>
        <span class="mobile">2025-02-17 10:39:34</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-10-09 16:14:31</span>
            <span class="mobile">2025-10-09 16:14:31</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Technology/">Technology</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/Technology/Bigdata/">Bigdata</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Hadoop/">Hadoop</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Hive/">Hive</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Hbase/">Hbase</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Bigdata/">Bigdata</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>12.7k 字</span>
        </span>
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h2 id="Hadoop2"><a href="#Hadoop2" class="headerlink" title="Hadoop2"></a>Hadoop2</h2><h2 id="七-Hive"><a href="#七-Hive" class="headerlink" title="七.Hive"></a>七.Hive</h2><ul>
<li>不统计是不走mapReduce的</li>
<li>最后ADS中的内容就是要被调用而不被调用的</li>
<li>默认走MapReduce引擎</li>
</ul>
<h3 id="（一）前期"><a href="#（一）前期" class="headerlink" title="（一）前期"></a>（一）前期</h3><h4 id="什么是"><a href="#什么是" class="headerlink" title="什么是"></a><strong>什么是</strong></h4><ul>
<li>基于Hadoop的<strong>数据仓库</strong>解决方案<ul>
<li>将结构化的数据文件映射为数据库表</li>
<li>提供类sql的查询语言HQL(Hive Query Language)</li>
<li>Hive让更多的人使用Hadoop</li>
</ul>
</li>
</ul>
<h4 id="优势和特点"><a href="#优势和特点" class="headerlink" title="优势和特点"></a><strong>优势和特点</strong></h4><ul>
<li><p>提供了一个简单的优化模型</p>
</li>
<li><p>HQL类SQL语法，简化MR开发</p>
</li>
<li><p>支持在不同的计算框架上运行</p>
</li>
<li><p>支持在HDFS和HBase上临时查询数据</p>
</li>
<li><p>支持用户自定义函数、格式</p>
</li>
<li><p>常用于ETL操作和BI</p>
<p>ETL：加载清理转化</p>
<p>BI：做图表</p>
</li>
<li><p>稳定可靠(真实生产环境)的批处理</p>
</li>
<li><p>有庞大活跃的社区</p>
</li>
</ul>
<h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><ul>
<li><p>映射hadoop数据成表</p>
</li>
<li><p>本身不存数据</p>
</li>
<li><p>自带一个小型数据库derby(相当于元数据库)，但是还是太小，再架设一个mysql为hive数据库。</p>
</li>
<li><p>图例和解释</p>
<p>Hive把hadoop元数据映射到mysql，用zeppelin来当数据库控制工具。</p>
<p>Hive相当于是一个中转的数据仓库，mysql中存元数据，hdfs中存原始数据，外部调用hive来结构化的查询。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/27.png"
                      style="zoom:80%;" 
                >
</li>
<li><p>做个人数据表映射的时候，脱敏操作，即敏感数据可以不映射</p>
</li>
</ul>
<h3 id="（二）内容"><a href="#（二）内容" class="headerlink" title="（二）内容"></a>（二）内容</h3><ul>
<li>数据库中大部分和Mysql一样，但是没有约束和主外键</li>
</ul>
<h3 id="（三）hive安装配置"><a href="#（三）hive安装配置" class="headerlink" title="（三）hive安装配置"></a>（三）hive安装配置</h3><ol>
<li><p>安装好hadoop</p>
</li>
<li><p>安装好mysql数据库，版本要对好，<strong>下面提前改好</strong></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">character-set-server=latin1</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/Sabthever/Pictures1/blob/main/Download_Resources/%E5%A4%A7%E6%95%B0%E6%8D%AEhive(%E5%8D%B7%E5%9B%9B).doc" >安装hive<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>，把hive-1.1.0-cdh5.14.2.tar.gz放入&#x2F;opt</p>
</li>
<li><p>解压移动编辑配置</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -zxf hive-1.1.0-cdh5.14.2.tar.gz</span><br><span class="line"><span class="built_in">mv</span> hive-1.1.0-cdh5.14.2 soft/hive110</span><br><span class="line"></span><br><span class="line">vim /etc/profile</span><br><span class="line">填入</span><br><span class="line"><span class="comment">#Hive Env</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/opt/soft/hive110</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># 保存退出</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /opt/soft/hive110/conf</span><br><span class="line">vim hive-site.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>vim hive-site.xml</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">填入</span><br><span class="line"># 第一个目录是自己改的</span><br><span class="line"># 第二个true为本地，false为其他IP</span><br><span class="line"># 下面的ip要相应改</span><br><span class="line"># 最下面密码别忘了</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.local<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://127.0.0.1:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.authentication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>NONE<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.client.user<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.client.password<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>上传一个mysql驱动包到hive110下的lib</p>
<p>驱动包是mysql-connector-java-5.1.38.jar，在maven下面的库中</p>
</li>
<li><p>jps确保五个服务都是启动状态，没有的话stop-all.sh;start-all.sh</p>
</li>
<li><p>启动hive服务（只能黑界面）</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --service metastore</span><br></pre></td></tr></table></figure></div>

<p><strong>启动后独占窗口，不能关闭</strong></p>
<p>jps多了RunJar</p>
<p>后台启动：<code>nohup hive --service metastore &amp;</code>两下回车，但没有返回值</p>
</li>
<li><p>再开一个新窗口，启动hive远程服务</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --service hiveserver2</span><br></pre></td></tr></table></figure></div>

<p><strong>启动后独占窗口，不能关闭</strong></p>
<p>jps多了RunJar</p>
<p>后台启动：<code>nohup hive --service hiveserver2 &amp;</code>但没有返回值</p>
</li>
<li><p>要使用再开窗口</p>
</li>
<li><p>hive命令直接进入数据库</p>
</li>
<li><p>创建数据表的时候可能会错，<code>MySQLSyntaxErrorException: Column length too big for column &#39;PARAM_VALUE&#39;</code></p>
<ul>
<li><p>退出后进入mysql -uroot -pok</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter database hive character set latin1;</span><br><span class="line">flush privileges;</span><br><span class="line">show variables like &#x27;char%&#x27;; -- 这句可以查看编码</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ol>
<ul>
<li><p>解释</p>
<p>要是会有扫描数据找不到</p>
<p>就执行初始化<code>schematool -dbType mysql -initSchema</code></p>
</li>
<li><p><strong>数据库元数据初始化命令：</strong><code>schematool -dbType derby -initSchema</code></p>
</li>
</ul>
<h3 id="（四）zeppelin安装配置"><a href="#（四）zeppelin安装配置" class="headerlink" title="（四）zeppelin安装配置"></a>（四）<a class="link"   target="_blank" rel="noopener" href="https://github.com/Sabthever/Pictures1/blob/main/Download_Resources/zepplin%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8.docx" >zeppelin安装配置<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></h3><ul>
<li>zeppelin时远程使用hive映射数据库的</li>
</ul>
<ol>
<li><p>zeppelin-0.8.1-bin-all.tgz放到&#x2F;opt下</p>
</li>
<li><p>解压</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -zxf zeppelin-0.8.1-bin-all.tgz;</span><br><span class="line"><span class="built_in">mv</span> zeppelin-0.8.1-bin-all soft/zeppelin081;</span><br><span class="line"><span class="built_in">cd</span> soft/zeppelin081/conf/;</span><br><span class="line"><span class="built_in">cp</span> zeppelin-site.xml.template zeppelin-site.xml</span><br><span class="line"><span class="built_in">cp</span> zeppelin-env.sh.template zeppelin-env.sh</span><br></pre></td></tr></table></figure></div>

<p>vim zeppelin-site.xml，加一个</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>zeppelin.helium.registry<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>helium<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>vim zeppelin-env.sh</p>
<p>这里面还能改内存、核</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/soft/jdk180</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=/opt/soft/hadoop260/etc/hadoop</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /opt/soft/hive110/conf/hive-site.xml /opt/soft/zeppelin081/conf/</span><br><span class="line"><span class="built_in">cp</span> /opt/soft/hadoop260/share/hadoop/common/hadoop-common-2.6.0-cdh5.14.2.jar /opt/soft/zeppelin081/interpreter/jdbc/</span><br><span class="line"><span class="built_in">cp</span> /opt/soft/hive110/lib/hive-jdbc-1.1.0-cdh5.14.2-standalone.jar /opt/soft/zeppelin081/interpreter/jdbc/</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>上传包java-json.jar</p>
<p>把这个包放到<code>/opt/soft/zeppelin081/lib</code>中</p>
</li>
<li><p>配置环境变量</p>
<p>vim &#x2F;etc&#x2F;profile加入</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Zepplin Env</span></span><br><span class="line"><span class="built_in">export</span> ZEPPELIN_HOME=/opt/soft/zeppelin081</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZEPPELIN_HOME</span>/bin</span><br></pre></td></tr></table></figure></div>

<p>source &#x2F;etc&#x2F;profile</p>
</li>
<li><p>结束</p>
<p>启动方法<code>zeppelin-daemon.sh start</code>，在这之前要重启hive</p>
</li>
</ol>
<h3 id="（五）使用"><a href="#（五）使用" class="headerlink" title="（五）使用"></a>（五）使用</h3><h4 id="1-第一次使用"><a href="#1-第一次使用" class="headerlink" title="1.第一次使用"></a>1.第一次使用</h4><ul>
<li>黑界面直接hive进入数据库</li>
</ul>
<ol>
<li>创建</li>
</ol>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database mydemo;</span><br><span class="line">use mydemo;</span><br><span class="line">create table userinfos(userid int,username string,birthday string);</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>创建数据表的时候可能会错，<code>MySQLSyntaxErrorException: Column length too big for column &#39;PARAM_VALUE&#39;</code></p>
<ul>
<li>退出后进入mysql -uroot -pok</li>
</ul>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter database hive character set latin1;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></div></li>
</ul>
<ol start="2">
<li><p>插入数据</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into userinfos values(1,&#x27;zs&#x27;,&#x27;1999-10-12&#x27;),(2,&#x27;ls&#x27;,&#x27;2000-10-12&#x27;);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>速度很慢，因为用了mapreduce的mapper</li>
</ul>
</li>
<li><p>读数据</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from userinfos;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>速度很快，没有mapreduce</li>
<li><strong>但是用聚合或者统计就会使用mapreduce</strong>，速度特别慢</li>
</ul>
</li>
<li><p>在hdfs下&#x2F;hive&#x2F;warehouse&#x2F;mydemo&#x2F;userinfos下有相应数据</p>
<p>这个路径是配置hive的时候自己的路径</p>
</li>
</ol>
<h4 id="2-远程连接和使用"><a href="#2-远程连接和使用" class="headerlink" title="2.远程连接和使用"></a>2.远程连接和使用</h4><ol>
<li><p><strong>第三方软件连接测试</strong></p>
<p>远程执行命令要开着</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --service hiveserver2</span><br></pre></td></tr></table></figure></div>

<p>在命令行下beeline</p>
<p>是自己改的hive配置的密码，再输入密码</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!connect jdbc:hive2://192.168.179.139:10000</span><br></pre></td></tr></table></figure></div>

<p>退出时<code>!q</code></p>
</li>
<li><p>zeppelin安装好</p>
</li>
<li><p>启动zeppelin，在这之前要启动hive</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zeppelin-daemon.sh start</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>远程连接</p>
<p>浏览器访问<a class="link"   target="_blank" rel="noopener" href="http://ip:8080/" >http://ip:8080/<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</li>
<li><p>使用下面是</p>
</li>
<li><p>界面右上角anonymous-&gt;Interpreter</p>
<p>create一个新的集成环境叫hive，用的是jdbc</p>
<p>在配置中配置</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">default.driver   org.apache.hive.jdbc.HiveDriver</span><br><span class="line">default.url     jdbc:hive2://192.168.42.200:10000</span><br><span class="line">default.user    root</span><br></pre></td></tr></table></figure></div>

<p>相应位置要输入密码</p>
<p>点击保存</p>
</li>
<li><p>点击上面的Noteboook-&gt;create new note</p>
<p>notename随便这边firsthive</p>
<p>默认的<strong>数据仓库</strong>(不是数据库)选hive</p>
</li>
<li><p>进入后就可以用sql语句了</p>
<p>但是这边不能使用<code>;</code>,每一句只能单行，如果要查某个数据库中的数据，就要如下<code>select * from mydemo.userinfos</code></p>
</li>
<li><p>除此之外</p>
<p>用%sh还可以指定使用的解释器</p>
</li>
</ol>
<h4 id="3-DataGrip远程连接"><a href="#3-DataGrip远程连接" class="headerlink" title="3.DataGrip远程连接"></a>3.DataGrip远程连接</h4><ol>
<li>开启hadoop和hive</li>
</ol>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br><span class="line"><span class="built_in">nohup</span> hive --service metastore &amp;</span><br><span class="line"><span class="built_in">nohup</span> hive --service hiveserver2 &amp;</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>配置datagriphive数据库</li>
<li>记得改驱动可以在hive下的lib找形如<code>hive-jdbc-1.1.0-cdh5.14.2-standalone.jar</code>要对应相应的版本</li>
</ol>
<h3 id="（六）详细学习"><a href="#（六）详细学习" class="headerlink" title="（六）详细学习"></a>（六）详细学习</h3><ul>
<li>函数没转过去会出空</li>
</ul>
<h4 id="1-数据类型"><a href="#1-数据类型" class="headerlink" title="1.数据类型"></a>1.数据类型</h4><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/28.png"
                      style="zoom:67%;" 
                >

<ul>
<li><p>string类型用的最多，数仓尽量用string</p>
</li>
<li><p>数据清洗就要转化为其他类型</p>
</li>
<li><p>比mysql中多了<strong>复杂类型数据</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/29.png"
                      style="zoom:80%;" 
                >

<ul>
<li>struct相当于一个对象</li>
</ul>
</li>
</ul>
<h4 id="2-Hive数据结构"><a href="#2-Hive数据结构" class="headerlink" title="2.Hive数据结构"></a>2.Hive数据结构</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/30.png"
                      style="zoom:80%;" 
                ></li>
<li>partition分区为了方便找数据</li>
<li>buckets在抽样过程中</li>
</ul>
<h4 id="3-数据库操作"><a href="#3-数据库操作" class="headerlink" title="3.数据库操作"></a>3.数据库操作</h4><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/31.png"
                     
                ></li>
<li>cascade是关联删除，会把依赖于主键的全删了</li>
</ul>
<h4 id="4-表操作"><a href="#4-表操作" class="headerlink" title="4.表操作"></a>4.<strong>表操作</strong></h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/33.png"
                     
                ></p>
</li>
<li><p>默认的分隔符是SOH即为<code>\001</code></p>
</li>
<li><p>regexp_replace相当于replace</p>
</li>
<li><p>还有temporary临时表，会话结束就没了</p>
</li>
<li><p>nvl()判断第一个表达式是否为null，<code>nvl(判断,否的话执行这条)</code></p>
</li>
<li><p>insert into追加</p>
<p>insert overwrite覆盖</p>
</li>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/52.png"
                     
                ></p>
<p>用这种方式就默认都是SOH</p>
</li>
<li><h3 id="创建内部表"><a href="#创建内部表" class="headerlink" title="创建内部表"></a>创建<strong>内部表</strong></h3><p>十分危险，删除表会<strong>连带着hdfs内部的数据全部删除</strong>，而非只删除元数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建一个内部表</span></span><br><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> student(</span><br><span class="line">id <span class="type">int</span>, name string</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 设置分隔符，默认SOH</span></span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span></span><br><span class="line"><span class="comment">-- 设置存储格式 除了textfile，ORC和Parquet是两个广泛使用的</span></span><br><span class="line">stored <span class="keyword">as</span> textfile</span><br><span class="line"><span class="comment">-- 设置存储位置 这个是可以自己定义的</span></span><br><span class="line">location<span class="string">&#x27;/home/hadoop/hive/warehouse/student&#x27;</span></span><br><span class="line"><span class="comment">--查询表的类型</span></span><br><span class="line"><span class="keyword">desc</span> formatted student;</span><br></pre></td></tr></table></figure></div>
</li>
<li><h3 id="创建外部表"><a href="#创建外部表" class="headerlink" title="创建外部表"></a>创建<strong>外部表</strong></h3><p><strong>只删元数据，不删数据本体</strong></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> student(</span><br><span class="line">	id <span class="type">int</span>, name string</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>
</li>
<li><h3 id="复杂类型分割"><a href="#复杂类型分割" class="headerlink" title="复杂类型分割"></a>复杂类型分割</h3><div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> mydemo.students(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string,</span><br><span class="line">    age <span class="type">int</span>,</span><br><span class="line">    likes <span class="keyword">array</span><span class="operator">&lt;</span>string<span class="operator">&gt;</span></span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span></span><br><span class="line">tblproperties(&quot;skip.header.line.count&quot;<span class="operator">=</span>&quot;1&quot;) <span class="comment">-- 跳过多少行</span></span><br><span class="line">location <span class="string">&#x27;/towers/students&#x27;</span></span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1,zs,20,豆浆:油条:烤鱼:烤鸭</span><br><span class="line">1,ls,21,包子:水煮面</span><br></pre></td></tr></table></figure></div>

<p>结果</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/34.png"
                      style="zoom:80%;" 
                >
</li>
<li><p>数据采集</p>
<p>就是数据放到hdfs，创建外部表做映射</p>
</li>
<li><h3 id="高阶建表语句"><a href="#高阶建表语句" class="headerlink" title="高阶建表语句"></a><strong>高阶建表语句</strong></h3><ul>
<li><p>这样建立的表是<strong>内部表</strong></p>
<p>而且底层数据复制了一份放在了默认的路径中</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> mydemo.friends1 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydemo.friends</span><br></pre></td></tr></table></figure></div>

<p><strong>用途</strong>：新建底层数据，在上面的select语句中加上where等，用于过滤数据。实际上数据仓库中就建立多层数据，映射、加工、服务一层一层的来过滤数据，需要很多中间表，就是上的的方法。</p>
</li>
<li><p>还可以这样子，就不会有数据 <em><strong>like</strong></em></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> mydemo.friends2 <span class="keyword">like</span> mydemo.friends</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
<li><h3 id="创建临时表"><a href="#创建临时表" class="headerlink" title="创建临时表"></a>创建临时表</h3></li>
<li><p>删除表</p>
<ul>
<li>删掉整个</li>
</ul>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> mydemo.friends</span><br></pre></td></tr></table></figure></div>

<p>​	不能用delete，因为照道理原始数据是不能改的</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/37.png"
                      alt="image-20240713145515802" style="zoom:67%;" 
                >


</li>
<li><h3 id="数据表分割问题"><a href="#数据表分割问题" class="headerlink" title="数据表分割问题"></a>数据表分割问题</h3><ol>
<li><p>朋友表，用excel出来的元数据如</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,张三,&quot;赵六,宋七&quot;</span><br><span class="line">2,李四,&quot;胡三,李儒&quot;</span><br><span class="line">3,王五,&quot;铃兰,张无忌,赵敏&quot;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>用下面的语句会出错</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> mydemo.friends(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string,</span><br><span class="line">    friends string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">location <span class="string">&#x27;/towers/friends&#x27;</span></span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/35.png"
                      style="zoom:67%;" 
                >
</li>
<li><p>这时候就有一个东西叫做：解析器</p>
</li>
</ol>
</li>
</ul>
<h4 id="5-解析器serde"><a href="#5-解析器serde" class="headerlink" title="5.解析器serde"></a>5.<strong>解析器</strong>serde</h4><ul>
<li><p>先解决4中的最后一个问题</p>
<p>如下就没问题了</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> mydemo.friends(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string,</span><br><span class="line">    friends string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format serde <span class="string">&#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span></span><br><span class="line"><span class="keyword">with</span> serdeproperties(</span><br><span class="line">    &quot;separatorChar&quot;<span class="operator">=</span>&quot;,&quot;,</span><br><span class="line">    &quot;quoteChar&quot;<span class="operator">=</span>&quot;\&quot;&quot;,</span><br><span class="line">    &quot;escapeChar&quot;=&quot;\\&quot;</span><br><span class="line">)</span><br><span class="line">-- row format delimited fields terminated by &#x27;,&#x27;</span><br><span class="line">location &#x27;/towers/friends&#x27;</span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/36.png"
                      alt="image-20240713142213770" style="zoom:67%;" 
                >

<ol>
<li><code>&quot;separatorChar&quot;=&quot;,&quot;</code>：这个属性指定了字段之间的分隔符。在这个例子中，分隔符被设置为逗号（<code>,</code>），这是CSV文件中最常见的分隔符。</li>
<li><code>&quot;quoteChar&quot;=&quot;\&quot;&quot;</code>：这个属性指定了用于包围字段值的字符，当字段值中包含分隔符、引号字符或换行符时，通常会用这些引号字符将字段值包围起来。在这个例子中，引号字符被设置为双引号（<code>&quot;</code>）。</li>
<li><code>&quot;escapeChar&quot;=&quot;\\&quot;</code>：这个属性指定了用于转义引号字符内的特殊字符的转义字符。然而，在CSV的上下文中，这个属性的具体行为可能会因实现而异，因为CSV标准本身并没有明确定义转义字符的使用。在<code>OpenCSVSerde</code>中，这个属性可能用于处理引号字符内部的引号字符（例如，通过前置一个反斜杠来转义引号），但这取决于<code>OpenCSVSerde</code>的具体实现和配置。然而，需要注意的是，在提供的例子中，转义字符被设置为反斜杠（<code>\</code>），但字符串值中的反斜杠自身需要被转义（即写成<code>\\</code>），这在许多编程语言中都是必要的，以确保反斜杠被正确地解析为字符串中的一个字符，而不是作为转义字符的开始。</li>
</ol>
</li>
</ul>
<h4 id="6-内部结构"><a href="#6-内部结构" class="headerlink" title="6.内部结构"></a>6.内部结构</h4><ul>
<li><p><strong>直接</strong>把<strong>相应格式</strong>的文件放到dfs中的相应目录中，就可以直接读取</p>
<p>因此可以在命令终端直接put</p>
</li>
</ul>
<h4 id="7-数据表上锁"><a href="#7-数据表上锁" class="headerlink" title="7.数据表上锁"></a>7.数据表上锁</h4><ul>
<li><p>当做删除等操作的时候一直运行没响应</p>
<p>把字符集改为latin1</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">character-set-server=latin1</span><br><span class="line"></span><br><span class="line">重启服务service mysqld restart</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>关闭zeppelin和hive</p>
</li>
<li><p>重启hive</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/32.png"
                      style="zoom:67%;" 
                ></li>
</ul>
<h4 id="8-装载数据LOAD"><a href="#8-装载数据LOAD" class="headerlink" title="8.装载数据LOAD"></a>8.装载数据LOAD</h4><ul>
<li><p>也可以在hdfs dfs -put来导入</p>
</li>
<li><p>LOAD用于在Hive中移动数据</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/38.png"
                      alt="image-20240713145729473" style="zoom:80%;" 
                >

<ul>
<li>LOCAL:指定文件位于本地文件系统，执行后为拷贝数据</li>
<li>OVERWRITE:表示覆盖表中现有数据</li>
</ul>
</li>
<li><p>示例</p>
<ul>
<li><p>把linux上的数据文件加载到mydemo.students的数据表</p>
<p><strong>如果没有overwrite，就相当于是追加</strong></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/testdata/t.txt&#x27;</span></span><br><span class="line">overwrite <span class="keyword">into</span> <span class="keyword">table</span> mydemo.students</span><br><span class="line"><span class="comment">-- select * from mydemo.students</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ul>
<h4 id="9-Hive分区（Partition）"><a href="#9-Hive分区（Partition）" class="headerlink" title="9.Hive分区（Partition）"></a>9.Hive分区（Partition）</h4><h5 id="A-介绍"><a href="#A-介绍" class="headerlink" title="A.介绍"></a>A.介绍</h5><ul>
<li><p>分区主要用于提高性能</p>
<ul>
<li>分区列的值将表划分为一个个的文件夹</li>
<li>查询时语法使用”分区”列和常规列类似</li>
<li>查询时Hive会只从指定分区查询数据，提高查询效率</li>
</ul>
</li>
<li><p>分为静态分区和动态分区</p>
<ul>
<li>两者的建表过程是相同的</li>
<li>静态分区：先添加分区（建立文件夹），用户传递</li>
<li>动态分区：更具数据来判断，只有sql执行时才会确定。动态分区个数也是可调的，一般是100个。很多时候扛不住，还是要静态分区，增量计算分区，每天一点往里塞</li>
</ul>
</li>
<li><p>比如销售的订单到部分按季度查，就按季度。决定粒度，取决于查询结果</p>
</li>
<li><p>分区表一般都是内部表</p>
</li>
<li><p><strong>静态分区</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/39.png"
                      style="zoom:67%;" 
                >
</li>
<li><p><strong>动态分区</strong></p>
<p>先塞数据进去，然后自动分区</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/42.png"
                      style="zoom:67%;" 
                ></li>
</ul>
<h5 id="B-静态例子1"><a href="#B-静态例子1" class="headerlink" title="B.静态例子1"></a>B.静态例子1</h5><ul>
<li><p>吊塔运行记录每天的数据</p>
</li>
<li><p>按天来进行最小粒度的划分</p>
</li>
<li><p>先进行数据的仿真模拟</p>
<div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTowerLog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 799 10*60*60</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        cal.set(<span class="number">2024</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMdd&quot;</span>);</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">// 准备五年间加名字20240101</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dirName</span> <span class="operator">=</span> sdf.format(cal.getTime());</span><br><span class="line">        <span class="comment">// 生成800个塔吊文件 塔吊编号+日期 zt0001_20240101.log</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">8</span>;i++)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;e:/Temp/towerdata/curr/&quot;</span> + dirName;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path);</span><br><span class="line">            <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">                file.mkdir();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(path + <span class="string">&quot;/&quot;</span> + towerLogFileName(i)</span><br><span class="line">                    + <span class="string">&quot;_&quot;</span> + dirName + <span class="string">&quot;.log&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> time=<span class="number">0</span>;time &lt;<span class="number">10</span>*<span class="number">60</span>*<span class="number">60</span>;time++)&#123;</span><br><span class="line">                <span class="comment">// 时间向前加</span></span><br><span class="line">                cal.add(Calendar.SECOND, <span class="number">1</span>);</span><br><span class="line">                <span class="comment">// 写日志字符串 日期时间中间加个T</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">logStr</span> <span class="operator">=</span> towerLogFileName(i) + <span class="string">&quot; &quot;</span></span><br><span class="line">                        + sdf1.format(cal.getTime()).replaceAll(<span class="string">&quot; &quot;</span>, <span class="string">&quot;T&quot;</span>) + <span class="string">&quot; &quot;</span> </span><br><span class="line">                        + rand.nextInt(<span class="number">12</span>) + <span class="string">&quot; &quot;</span></span><br><span class="line">                        + rand.nextInt(<span class="number">10</span>) + <span class="string">&quot; &quot;</span></span><br><span class="line">                        + rand.nextInt(<span class="number">15</span>) + <span class="string">&quot; &quot;</span></span><br><span class="line">                        + rand.nextInt(<span class="number">5</span>) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                        raf.write(logStr.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            raf.write(<span class="string">&quot;hehe&quot;</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            raf.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">towerLogFileName</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;zk&quot;</span> + String.format(<span class="string">&quot;%04d&quot;</span>, no);</span><br><span class="line">        <span class="keyword">return</span> filename;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>数据文件夹如下</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/40.png"
                      style="zoom:80%;" 
                >

<p>数据形如</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zk0000 2024-01-01T08:00:01 6 1 5 4</span><br><span class="line">zk0000 2024-01-01T08:00:02 3 8 2 2</span><br><span class="line">zk0000 2024-01-01T08:00:03 5 0 1 4</span><br><span class="line">zk0000 2024-01-01T08:00:04 3 3 2 2</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建分区表</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> mydemo.towerdatas(</span><br><span class="line">    id string,</span><br><span class="line">    ts string,</span><br><span class="line">    weight string,</span><br><span class="line">    speed string,</span><br><span class="line">    <span class="keyword">range</span> string,</span><br><span class="line">    angle string</span><br><span class="line">)</span><br><span class="line">partitioned <span class="keyword">by</span>  (ymd string)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27; &#x27;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建静态分区</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="keyword">alter table</span> mydemo.towerdatas <span class="keyword">add</span> <span class="keyword">partition</span>(ymd<span class="operator">=</span><span class="string">&#x27;20240101&#x27;</span>)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>载入数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/testdata/20240101/&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> mydemo.towerdatas <span class="keyword">partition</span>(ymd<span class="operator">=</span><span class="string">&#x27;20240101&#x27;</span>)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>最终结果</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/41.png"
                      style="zoom:80%;" 
                >
</li>
<li><p>实际中要用脚本每天把数据放入</p>
<p><code>hive -e &quot;命令&quot;</code>可以直接运行，当然也可以<code>echo &quot;命令&quot; | hive</code>这样来运行</p>
<p>远程脚本可以如下，这个脚本要在能够ssh免密登录的时候才可以这样做</p>
<ul>
<li><p>实际要做的步骤</p>
<ol>
<li>将日志服务器上的数据传递给hadoop集群</li>
<li>在hive上的某个分区表上添加分区</li>
<li>将本地接到的数据加载到这个分区中</li>
<li>删除本地数据</li>
<li>每天都要做(crontab定时任务)</li>
</ol>
</li>
<li><p>脚本示例</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取当天日期，按照实际要是前一天，而不是当天的</span></span><br><span class="line">foldername=`<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d&quot;</span>`</span><br><span class="line">scp -r /opt/data/<span class="variable">$foldername</span> root@192.168.179.139:/opt/towerdata/</span><br><span class="line"><span class="comment"># 在hive的towerdatas表中建立昨日分区</span></span><br><span class="line">CREATEPARTITIONSTR=<span class="string">&quot;alter table mydemo.towerdatas add partition(ymd=&#x27;<span class="variable">$&#123;foldername&#125;</span>&#x27;);&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hive -e \&quot;<span class="variable">$CREATEPARTITIONSTR</span>\&quot;&quot;</span> | ssh root@192.168.179.139</span><br><span class="line"><span class="comment"># 将本地数据导入昨日分区</span></span><br><span class="line">IMORTDATASTR=<span class="string">&quot;load data local inpath &#x27;/opt/towerdata/<span class="variable">$foldername</span>&#x27; into table mydemo.towerdatas partition(ymd=&#x27;<span class="variable">$foldername</span>&#x27;)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hive -e \&quot;<span class="variable">$IMORTDATASTR</span>\&quot;&quot;</span> | ssh root@192.168.179.139</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将linux上的数据删除</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rm -rf /opt/towerdata/<span class="variable">$foldername</span>/&quot;</span> | ssh root@192.168.179.139</span><br><span class="line"><span class="comment"># 删除半年前的数据分区</span></span><br><span class="line">foldername=`<span class="built_in">date</span> -d <span class="string">&quot;-196 day&quot;</span> <span class="string">&#x27;+%Y%m%d&#x27;</span>`</span><br><span class="line">DROPPARTITIONSTR=<span class="string">&quot;alter table mydemo.towerdatas drop partition(ymd=<span class="variable">$foldername</span>)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hive -e \&quot;<span class="variable">$DROPPARTITIONSTR</span>\&quot;&quot;</span> | ssh root@192.168.179.139</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>crontab设置定时任务</p>
<p><code>crontab -e</code></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.cron</span></span><br><span class="line">1 * * * * <span class="built_in">source</span> ~/example.sh</span><br><span class="line"><span class="comment"># 每一分钟执行一次</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ul>
<h5 id="C-动态例子1"><a href="#C-动态例子1" class="headerlink" title="C.动态例子1"></a>C.动态例子1</h5><ul>
<li><p>过程</p>
<ol>
<li>将一堆数据导入hdfs</li>
<li>在hadoop上使用归档把所有数据压缩到一个文件中</li>
<li>在hive建立一个临时的表并存储数据</li>
<li>将临时表的数据通过insert语句动态存放到分区表中</li>
</ol>
</li>
<li><p>数据仿真</p>
<p>很多很多天的数据以单条目生成，小改了一下</p>
<div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成300天数据</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> day=<span class="number">0</span>;day&lt;<span class="number">300</span>;day++) &#123;</span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">    cal.set(<span class="number">2024</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    cal.add(Calendar.DATE, day);</span><br><span class="line">    <span class="comment">// 准备五年间加名字20240101</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">dirName</span> <span class="operator">=</span> sdf.format(cal.getTime());</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>过程</p>
<ol>
<li><p>在hadoop建立一个临时文件夹并上传所有数据到临时文件夹</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -<span class="built_in">mkdir</span> /datatmp</span><br><span class="line">hdfs dfs -put /opt/towerdata /datatmp</span><br><span class="line">hdfs dfs -<span class="built_in">mkdir</span> /dataarchive <span class="comment"># 执行一次就够了</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>由于小文件过多所以使用hadoop将众多的小文件进行归档</p>
<p><code>hadoop archive -archiveName data1.har -p /datatmp/towerdata /dataarchive</code></p>
</li>
<li><p>查看归档文件信息</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -<span class="built_in">cat</span> /dataarchive/data1.har/part-0</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在数据仓库中创建一个<strong>临时表</strong></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> temporary <span class="keyword">table</span> mydemo.temps(</span><br><span class="line">    id string,</span><br><span class="line">    ts string,</span><br><span class="line">    weight string,</span><br><span class="line">    speed string,</span><br><span class="line">    <span class="keyword">range</span> string,</span><br><span class="line">    angle string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line">location <span class="string">&#x27;/dataarchive/data1.har&#x27;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>将临时表的数据使用insert语句导入到分区表中</p>
<p>导入过程不一定吃得消，要么就脚本分段导入要么调整hadoop参数，网上找好，包括线程数，内存数</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hdfs-site.xml中</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--datanode上负责进行文件操作的线程数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.max.transfer.threads<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>32768<span class="tag">&lt;/<span class="name">value</span>&gt;</span> 改大小默认4096</span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启动态分区</span></span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition<span class="operator">=</span><span class="literal">true</span>;</span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition.mode<span class="operator">=</span>nonstrict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> mydemo.towerdatas <span class="keyword">partition</span>(ymd) <span class="keyword">select</span> t.<span class="operator">*</span>,regexp_replace(<span class="built_in">substring</span>(t.ts,<span class="number">0</span>,<span class="number">10</span>),<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&#x27;</span>) ymd <span class="keyword">from</span> mydemo.temps t</span><br><span class="line">改为，</span><br><span class="line"><span class="keyword">insert into</span> mydemo.towerdatas <span class="keyword">partition</span>(ymd)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> t.<span class="operator">*</span>,regexp_replace(<span class="built_in">substring</span>(t.ts,<span class="number">0</span>,<span class="number">10</span>),<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&#x27;</span>) ymd <span class="keyword">from</span> mydemo.temps t) f <span class="keyword">where</span> f.ymd <span class="keyword">like</span> <span class="string">&#x27;2024012%&#x27;</span></span><br><span class="line">要性能调优</span><br></pre></td></tr></table></figure></div>

<ul>
<li>写快出问题了，调整文件句柄数，提高线程数，同时不让超过内存</li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="10-分桶"><a href="#10-分桶" class="headerlink" title="10.分桶"></a>10.分桶</h4><h5 id="A-知识点"><a href="#A-知识点" class="headerlink" title="A.知识点"></a>A.知识点</h5><ul>
<li><p>Bucket</p>
</li>
<li><p>分桶对应于HDFS中的文件</p>
<ul>
<li>更高的查询处理效率</li>
<li>使抽样（sampling）更高效</li>
<li>一般根据”桶列”的哈希函数将数据进行分桶</li>
</ul>
</li>
<li><p>分桶只有动态分桶</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> hive.enforce.bucketing <span class="operator">=</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>定义分桶</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLUSTERED <span class="keyword">BY</span> (employee_id) <span class="keyword">INTO</span> <span class="number">2</span> BUCKETS</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>必须使用INSERT方式加载数据</p>
</li>
<li><p><strong>分桶抽样</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/43.png"
                      style="zoom:67%;" 
                >

<ul>
<li><p>第一句话，第一个3是从哪个桶开始抽取。32可大于可小于桶数，代表取<code>桶数/32</code>个桶的数据</p>
</li>
<li><p>rand()为随机采样，rand(num)为伪随机</p>
</li>
<li><p>除此之外，可以</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydemo.mybucket <span class="keyword">tablesample</span>(<span class="number">40</span> <span class="keyword">percent</span>) <span class="comment">-- 百分比采样</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydemo.mybucket <span class="keyword">tablesample</span>(<span class="number">20</span>B) <span class="comment">-- 字节采样</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydemo.mybucket <span class="keyword">tablesample</span>(<span class="number">4</span> <span class="keyword">rows</span>) <span class="comment">-- 按行采样</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ul>
<h5 id="B-例子1jp"><a href="#B-例子1jp" class="headerlink" title="B.例子1jp"></a>B.例子1jp</h5><ol>
<li><p>开启分桶功能</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.enforce.bucketing<span class="operator">=</span><span class="literal">true</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>设置reduce个数和桶的数量一致</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapreduce.job.reduces<span class="operator">=</span><span class="number">4</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建1个分桶表</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> mydemo.mybucket(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string,</span><br><span class="line">    gender string,</span><br><span class="line">    age <span class="type">int</span></span><br><span class="line">)</span><br><span class="line">clustered <span class="keyword">by</span> (id) <span class="keyword">into</span> <span class="number">4</span> buckets</span><br><span class="line">stored <span class="keyword">as</span> textfile</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>插入数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> mydemo.mybucket <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">2</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">3</span>,<span class="string">&#x27;ww&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">4</span>,<span class="string">&#x27;zl&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">5</span>,<span class="string">&#x27;sq&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">6</span>,<span class="string">&#x27;wb&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">7</span>,<span class="string">&#x27;cq&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">8</span>,<span class="string">&#x27;es&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">9</span>,<span class="string">&#x27;io&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>),(<span class="number">10</span>,<span class="string">&#x27;zw&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">20</span>)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>结果</p>
<p>四个小文件，四个reduce，分区是多文件夹</p>
<p>第一个中</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8es男20</span><br><span class="line">4zl男20</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>数据采样</p>
<ul>
<li><p>拿了1、3桶的所有数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydemo.mybucket <span class="keyword">tablesample</span>(bucket <span class="number">1</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">2</span>) s</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>拿1桶所有</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mydemo.mybucket <span class="keyword">tablesample</span>(bucket <span class="number">1</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">4</span>) s</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>拿半个桶的</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from mydemo.mybucket tablesample(bucket 1 out of 8) s</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ol>
<h4 id="11-分区和分桶的不同"><a href="#11-分区和分桶的不同" class="headerlink" title="11.分区和分桶的不同"></a>11.分区和分桶的不同</h4><ul>
<li>分区是表的部分列的集合，可以为频繁使用的数据建立分区，这样查找分区中的数据时就不需要扫描全表，这对于提高查找效率很有帮助</li>
<li>不同于分区对列直接进行拆分，桶往往使用列的哈希值对数据打散，并分发到各个不同的桶中从而完成数据的分桶过程</li>
<li>分区和分桶最大的区别就是分桶随机分割数据库，分区是非随机分割数据库</li>
<li>分区在底层是一个个文件夹，分桶是一个个文件</li>
</ul>
<h4 id="12-Hive视图-View"><a href="#12-Hive视图-View" class="headerlink" title="12.Hive视图(View)"></a>12.Hive视图(View)</h4><h5 id="A-介绍-1"><a href="#A-介绍-1" class="headerlink" title="A.介绍"></a>A.介绍</h5><ul>
<li><p>视图概述</p>
<ul>
<li>通过隐藏子查询、连接和函数来简化查询的逻辑结构</li>
<li>只保存定义，不存储数据</li>
<li>如果删除或更改基础表，则查询视图将失败</li>
<li>视图是只读的，不能插入或装载数据</li>
</ul>
</li>
<li><p>应用场景</p>
<ul>
<li>将特定的列提供给用户，保护数据隐私</li>
<li>用于查询语句复杂的场景</li>
</ul>
</li>
<li><p><strong>Hive侧视图</strong>（Lateral View）</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/44.png"
                      style="zoom:67%;" 
                >
</li>
<li><p>举例</p>
<ul>
<li><p>最早左边，分为右边，最后变成</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> lineno,ctx,split(ctx,<span class="string">&#x27; &#x27;</span>) ctxarr <span class="keyword">from</span> mydemo.article</span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/45.png"
                      style="zoom:80%;" 
                >
</li>
<li><p>这样子就最终</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/46.png"
                      style="zoom:80%;" 
                >
</li>
<li><p>但是不知道是属于哪个，因此可以用视图</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> lineno,ctx, word <span class="keyword">from</span> mydemo.article <span class="keyword">lateral</span> <span class="keyword">view</span> explode(split(ctx,<span class="string">&#x27; &#x27;</span>)) a <span class="keyword">as</span> word</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/47.png"
                     
                ></p>
</li>
<li><p>还可以带上排序</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> lineno,ctx,<span class="keyword">no</span>,word <span class="keyword">from</span> mydemo.article <span class="keyword">lateral</span> <span class="keyword">view</span> posexplode(split(ctx,<span class="string">&#x27; &#x27;</span>)) a <span class="keyword">as</span> <span class="keyword">no</span>,word</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/48.png"
                     
                ></p>
</li>
<li><p>&#x3D;&#x3D;explode炸开&#x3D;&#x3D;比较重要，<strong>一列值分割转行</strong>。和真正的<strong>列转行</strong>有区别，真正的列转行是多列转行，用的是<strong>多次查询后Union</strong></p>
</li>
</ul>
</li>
</ul>
<h4 id="13-Hive高级查询"><a href="#13-Hive高级查询" class="headerlink" title="13.Hive高级查询"></a>13.Hive高级查询</h4><h5 id="A-查询"><a href="#A-查询" class="headerlink" title="A.查询"></a>A.查询</h5><ul>
<li><p>基本和mysql相同，有个<em><strong>rlike</strong></em></p>
<p>rlike后面跟正则，形如<code>select * from mydemo.mybucket where name rlike &#39;z[a-z]*&#39;</code></p>
</li>
<li><p>CTE语法</p>
<p>with t1 as</p>
</li>
<li><p>join方式</p>
</li>
</ul>
<h5 id="B"><a href="#B" class="headerlink" title="B."></a>B.</h5><h5 id="c"><a href="#c" class="headerlink" title="c."></a>c.</h5><h4 id="14-一次练习"><a href="#14-一次练习" class="headerlink" title="14.一次练习"></a>14.一次练习</h4><ul>
<li>上课商店销售分析练习</li>
</ul>
<h5 id="A-商店销售分析练习1-DOS"><a href="#A-商店销售分析练习1-DOS" class="headerlink" title="A.商店销售分析练习1-DOS"></a>A.商店销售分析练习1-DOS</h5><ol>
<li><p>在hadoop上建立存储数据的文件夹 并上传文件到对应的文件夹</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%sh</span><br><span class="line">hdfs dfs -<span class="built_in">mkdir</span> -p /storeanaly/customer</span><br><span class="line">hdfs dfs -<span class="built_in">mkdir</span> -p /storeanaly/store</span><br><span class="line">hdfs dfs -<span class="built_in">mkdir</span> -p /storeanaly/tran</span><br><span class="line">hdfs dfs -put /opt/testdata/jydata/customer_details.csv /storeanaly/customer</span><br><span class="line">hdfs dfs -put /opt/testdata/jydata/store_details.csv /storeanaly/store</span><br><span class="line">hdfs dfs -put /opt/testdata/jydata/transaction_details.csv /storeanaly/tran</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>创建映射原始文件的数据仓库ODS_SALE</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database ods_sale</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在近源层数据库中创建映射的数据表-ods_customer</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> ods_sale.ods_customer(</span><br><span class="line">    customer_id string,</span><br><span class="line">    first_name string,</span><br><span class="line">    last_name string,</span><br><span class="line">    email string,</span><br><span class="line">    gender string,</span><br><span class="line">    address string,</span><br><span class="line">    country string,</span><br><span class="line">    <span class="keyword">language</span> string,</span><br><span class="line">    job string,</span><br><span class="line">    credit_type string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format serde <span class="string">&#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span></span><br><span class="line"><span class="keyword">with</span> serdeproperties(</span><br><span class="line">    &quot;separatorChar&quot;<span class="operator">=</span>&quot;,&quot;,</span><br><span class="line">    &quot;quoteChar&quot;<span class="operator">=</span>&quot;\&quot;&quot;,</span><br><span class="line">    &quot;escapeChar&quot;=&quot;\\&quot;</span><br><span class="line">)</span><br><span class="line">location &#x27;/storeanaly/customer&#x27;</span><br><span class="line">tblproperties(&quot;skip.header.line.count&quot;=&quot;<span class="number">1</span>&quot;)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在近源层数据库中创建映射的数据表-ods_store</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> ods_sale.ods_store(</span><br><span class="line">    store_id string,</span><br><span class="line">    store_name string,</span><br><span class="line">    employee_number string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format serde <span class="string">&#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span></span><br><span class="line"><span class="keyword">with</span> serdeproperties(</span><br><span class="line">    &quot;separatorChar&quot;<span class="operator">=</span>&quot;,&quot;,</span><br><span class="line">    &quot;quoteChar&quot;<span class="operator">=</span>&quot;\&quot;&quot;,</span><br><span class="line">    &quot;escapeChar&quot;=&quot;\\&quot;</span><br><span class="line">)</span><br><span class="line">location &#x27;/storeanaly/store&#x27;</span><br><span class="line">tblproperties(&quot;skip.header.line.count&quot;=&quot;<span class="number">1</span>&quot;)</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在近源层数据库中创建映射的数据表-ods_trans</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> ods_sale.ods_trans(</span><br><span class="line">    transaction_id string,</span><br><span class="line">    customer_id string,</span><br><span class="line">    store_id string,</span><br><span class="line">    price string,</span><br><span class="line">    product string,</span><br><span class="line">    trandate string,</span><br><span class="line">    trantime string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format serde <span class="string">&#x27;org.apache.hadoop.hive.serde2.OpenCSVSerde&#x27;</span></span><br><span class="line"><span class="keyword">with</span> serdeproperties(</span><br><span class="line">    &quot;separatorChar&quot;<span class="operator">=</span>&quot;,&quot;,</span><br><span class="line">    &quot;quoteChar&quot;<span class="operator">=</span>&quot;\&quot;&quot;,</span><br><span class="line">    &quot;escapeChar&quot;=&quot;\\&quot;</span><br><span class="line">)</span><br><span class="line">location &#x27;/storeanaly/tran&#x27;</span><br><span class="line">tblproperties(&quot;skip.header.line.count&quot;=&quot;<span class="number">1</span>&quot;)</span><br></pre></td></tr></table></figure></div>


</li>
<li><p>对ods_customer进行数据探索工作</p>
<p>每一个表的逐条数据进行探索，格式对不对，有没有重复等等，并且要有一定的处理方法</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>hive</span><br><span class="line"><span class="comment">-- select count(1) from ods_sale.ods_customer -- 500</span></span><br><span class="line"><span class="comment">-- select count(customer_id) from ods_sale.ods_customer where trim(customer_id)!=&quot;&quot;</span></span><br><span class="line"><span class="comment">-- select count(distinct customer_id) from ods_sale.ods_customer</span></span><br><span class="line"><span class="comment">-- select count(1) from ods_sale.ods_customer where customer_id rlike &#x27;^[0-9]+$&#x27;</span></span><br><span class="line"><span class="comment">-- select count(*) from ods_sale.ods_customer where first_name is null or last_name is null or trim(first_name)=&#x27;&#x27; or trim(last_name)=&#x27;&#x27;</span></span><br><span class="line"><span class="comment">-- select concat(first_name,last_name) from ods_sale.ods_customer group by concat(first_name,last_name) having count(concat(first_name,last_name))&gt;1</span></span><br><span class="line"><span class="comment">-- select * from ods_sale.ods_customer where email is not null and trim(email)!=&#x27;&#x27; and email not rlike &#x27;^([0-9a-zA-Z]+@[0-9a-zA-Z]+(\\-[0-9a-zA-Z]+)?(\\.[0-9a-zA-Z]+)?\\.[0-9a-zA-Z]+)$&#x27;    -- 邮箱域名地址中可能存放在 - 字符 或者只有1个字符的情况</span></span><br><span class="line"><span class="comment">-- select gender from ods_sale.ods_customer group by gender</span></span><br><span class="line"><span class="comment">-- with t1 as(select country,count(1) from ods_sale.ods_customer group by country)</span></span><br><span class="line"><span class="comment">-- select * from t1 where country=&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---探索ods_store</span></span><br><span class="line"><span class="comment">-- select * from ods_sale.ods_store</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 探索ods_sale.ods_trans</span></span><br><span class="line"><span class="comment">-- select count(*) from ods_sale.ods_trans  -- 8100</span></span><br><span class="line"><span class="comment">-- select count(transaction_id) from ods_sale.ods_trans where trim(transaction_id)!=&quot;&quot;</span></span><br><span class="line"><span class="comment">-- select count(distinct transaction_id) from ods_sale.ods_trans  -- 8000 有100行是重复的 修改订单编号 8004 8004_1</span></span><br><span class="line"><span class="comment">-- select transaction_id from ods_sale.ods_trans group by transaction_id having count(transaction_id)&gt;1</span></span><br><span class="line"><span class="comment">-- with t1 as(select distinct * from ods_sale.ods_trans) select count(1) from t1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- select count(t.customer_id) from ods_sale.ods_trans t inner join ods_sale.ods_customer c on t.customer_id=c.customer_id</span></span><br><span class="line"><span class="comment">-- select store_id from ods_sale.ods_trans group by store_id</span></span><br><span class="line"><span class="comment">-- select * from ods_sale.ods_trans where price not rlike &#x27;^[0-9]+(\.[0-9]&#123;1,&#125;)?$&#x27;</span></span><br><span class="line"><span class="comment">-- select * from ods_sale.ods_trans where trim(product)=&#x27;&#x27;</span></span><br><span class="line"><span class="comment">-- select * from ods_sale.ods_trans where trandate not rlike &#x27;^[1,2][0-9]&#123;3&#125;\-[0-9]&#123;1,2&#125;\-[0-9]&#123;1,2&#125;$&#x27;</span></span><br><span class="line"><span class="comment">-- select * from ods_sale.ods_trans where trantime not rlike &#x27;^[0-9]&#123;1,2&#125;:[0-9]&#123;1,2&#125;$&#x27;  -- 10:32 PM将此种数据转为24小时制 22：32</span></span><br></pre></td></tr></table></figure></div></li>
</ol>
<h5 id="B-商店销售分析练习2-DWD"><a href="#B-商店销售分析练习2-DWD" class="headerlink" title="B.商店销售分析练习2-DWD"></a>B.商店销售分析练习2-DWD</h5><ol>
<li><p>创建数据明细层数据库dwd_sale</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database dwd_sale</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>根据ods的customer表导入dwd的customer</p>
<p><strong>这步其实是可以压缩的</strong></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> dwd_sale.dwd_customer <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ods_sale.ods_customer</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>根据ods的store表导入dwd的store</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> dwd_sale.dwd_store <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ods_sale.ods_store</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>5 创建自定义事件处理函数</p>
<ul>
<li><p>跳到15那的Java示例1</p>
</li>
<li><p>上传jar包到hdfs</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -<span class="built_in">mkdir</span> -p /func</span><br><span class="line">hdfs dfs -put /opt/timefunc-1.0-SNAPSHOT.jar /func</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在hive上使用hdfs上的jar包创建永久函数</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> timehandler <span class="keyword">as</span> <span class="string">&#x27;com.njupt.timefunc.TimeChange&#x27;</span> <span class="keyword">using</span> jar <span class="string">&#x27;hdfs://192.168.179.139:9000/func/timefunc-1.0-SNAPSHOT.jar&#x27;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>如果jar包错了，要在idea中清理缓存File-invalidate caches</p>
<p>然后再hive中要先drop function，再重启zeppelin和hive</p>
<p>最后再来一遍</p>
</li>
</ul>
</li>
<li><p>创建自定义事件处理函数</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create table dwd_sale.dwd_trans like ods_sale.ods_trans -- 执行一次</span></span><br><span class="line"><span class="keyword">with</span></span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> t.<span class="operator">*</span>,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> transaction_id <span class="keyword">order</span> <span class="keyword">by</span> customer_id) rank <span class="keyword">from</span> ods_sale.ods_trans t),</span><br><span class="line">t3 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> rank<span class="operator">=</span><span class="number">1</span> <span class="keyword">then</span> transaction_id <span class="keyword">else</span> concat(transaction_id,<span class="string">&#x27;_&#x27;</span>,rank) <span class="keyword">end</span> transaction_id,</span><br><span class="line">        customer_id,store_id,price,product,trandate,timehandler(trantime) <span class="keyword">as</span> trantime <span class="keyword">from</span> t2)</span><br><span class="line"><span class="keyword">insert into</span> dwd_sale.dwd_trans <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t3</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h5 id="C-商店销售分析练习3-DWS"><a href="#C-商店销售分析练习3-DWS" class="headerlink" title="C.商店销售分析练习3-DWS"></a>C.商店销售分析练习3-DWS</h5><ul>
<li>数据服务层，用于业务处理</li>
<li>这边没有什么要用的，直接导进来就好了</li>
</ul>
<ol>
<li><p>创建dws数据服务层数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database dws_sale</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>将dwd中的表导入到dws层 构建数据模型 并做初步聚合工作</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> dws_sale.dws_customer <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dwd_sale.dwd_customer</span><br><span class="line"><span class="keyword">create table</span> dws_sale.dws_store <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dwd_sale.dwd_store</span><br><span class="line"><span class="keyword">create table</span> dws_sale.dws_trans <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dwd_sale.dwd_trans</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h5 id="D-商店销售分析练习3-ADS"><a href="#D-商店销售分析练习3-ADS" class="headerlink" title="D.商店销售分析练习3-ADS"></a>D.商店销售分析练习3-ADS</h5><ol>
<li><p>创建数据应用层数据库ADS</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database ads_sale</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>销售主题域-指标1 查询各国顾客表占比</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span></span><br><span class="line">t1 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) cnt_cust_number <span class="keyword">from</span> dws_sale.dws_customer),</span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> country,<span class="built_in">count</span>(<span class="number">1</span>) country_cust_number <span class="keyword">from</span> dws_sale.dws_customer <span class="keyword">group</span> <span class="keyword">by</span> country),</span><br><span class="line">t3 <span class="keyword">as</span>(<span class="keyword">select</span> t2.<span class="operator">*</span>,t1.cnt_cust_number <span class="keyword">from</span> t1 <span class="keyword">cross</span> <span class="keyword">join</span> t2)</span><br><span class="line"><span class="keyword">select</span> country,(country_cust_number<span class="operator">*</span><span class="number">1.0</span><span class="operator">/</span>cnt_cust_number)<span class="operator">*</span><span class="number">100</span> kindCountryPerc <span class="keyword">from</span> t3</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>销售主题域-指标2 查询订单表中共有多少不同顾客下过订单和多少顾客没有下过订单</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span></span><br><span class="line">t1 <span class="keyword">as</span>(<span class="keyword">select</span> customer_id <span class="keyword">from</span> dws_sale.dws_trans <span class="keyword">group</span> <span class="keyword">by</span> customer_id),</span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> c.customer_id,t.customer_id cid <span class="keyword">from</span> dws_sale.dws_customer c <span class="keyword">left</span> <span class="keyword">join</span> t1 t <span class="keyword">on</span> c.customer_id<span class="operator">=</span>t.customer_id),</span><br><span class="line">t3 <span class="keyword">as</span>(<span class="keyword">select</span> customer_id <span class="keyword">from</span> t2 <span class="keyword">where</span> cid <span class="keyword">is</span> <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;gooduser&#x27;</span> cust, <span class="built_in">count</span>(<span class="number">1</span>) number <span class="keyword">from</span> t1</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;baduser&#x27;</span> cust,<span class="built_in">count</span>(<span class="number">1</span>) number <span class="keyword">from</span> t3</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>销售主题域-指标3 查询商品表中购买数量前五的商品</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span></span><br><span class="line">t1 <span class="keyword">as</span>(<span class="keyword">select</span> product,<span class="built_in">count</span>(<span class="number">1</span>) buy_num <span class="keyword">from</span> dws_sale.dws_trans <span class="keyword">group</span> <span class="keyword">by</span> product),</span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> product,buy_num,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> buy_num <span class="keyword">desc</span>) rk <span class="keyword">from</span> t1)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t2 <span class="keyword">where</span> rk <span class="operator">&lt;=</span><span class="number">5</span></span><br></pre></td></tr></table></figure></div></li>
</ol>
<h4 id="15-Hive函数和Java"><a href="#15-Hive函数和Java" class="headerlink" title="15.Hive函数和Java"></a>15.Hive函数和Java</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/57.png"
                     
                ></p>
<ul>
<li>UDF相当于出一个 UDAF UDTF</li>
<li>UDF一进一出</li>
<li>UDAF：多进一出，类似max，min</li>
<li>UDTF：一进多出，类似explode</li>
</ul>
<h5 id="A-UDF"><a href="#A-UDF" class="headerlink" title="A.UDF"></a>A.UDF</h5><ul>
<li><p>总体</p>
</li>
<li><p><em>User Defined Function</em></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/50.png"
                     
                ></p>
</li>
<li><p>Java示例1</p>
<ol>
<li><p>导入包</p>
<p>比较难导入</p>
 <div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-exec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>时间变化pm am 或者没有改成24小时</p>
<p>要多考虑边界</p>
<div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.njupt.timefunc;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeChange</span> <span class="keyword">extends</span> <span class="title class_">UDF</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 3:41 3:41 AM 3:41 PM</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">evaluate</span><span class="params">(String time)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">hour</span> <span class="operator">=</span> Integer.parseInt(time.split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (hour &gt;= <span class="number">12</span>) &#123;</span><br><span class="line">            <span class="type">Pattern</span> <span class="variable">tm</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;([0-9]&#123;1,2&#125;:[0-9]&#123;1,2&#125;).*&quot;</span>);</span><br><span class="line">            <span class="type">Matcher</span> <span class="variable">mt</span> <span class="operator">=</span> tm.matcher(time);</span><br><span class="line">            mt.find();</span><br><span class="line">            <span class="keyword">return</span> mt.group(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Pattern amReg=Pattern.compile(<span class="string">&quot;(.*)[aA][mM]&quot;</span>);</span><br><span class="line">            Pattern pmReg=Pattern.compile(<span class="string">&quot;(.*)[pP][mM]&quot;</span>);</span><br><span class="line">            <span class="type">Matcher</span> <span class="variable">amM</span> <span class="operator">=</span> amReg.matcher(time);</span><br><span class="line">            <span class="type">Matcher</span> <span class="variable">pmM</span> <span class="operator">=</span> pmReg.matcher(time);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (amM.find()) &#123;</span><br><span class="line">                <span class="comment">// 上午时间</span></span><br><span class="line">                <span class="keyword">return</span> amM.group(<span class="number">1</span>).trim();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pmM.find()) &#123;</span><br><span class="line">                <span class="comment">// 下午时间</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">pm</span> <span class="operator">=</span> pmM.group(<span class="number">1</span>).trim();</span><br><span class="line">                String[] times = pm.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> (Integer.parseInt(times[<span class="number">0</span>])+<span class="number">12</span>)+<span class="string">&quot;:&quot;</span>+times[<span class="number">1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> time;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">t</span> <span class="operator">=</span> <span class="string">&quot;13:31 pM&quot;</span>;</span><br><span class="line">        <span class="type">TimeChange</span> <span class="variable">tc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimeChange</span>();</span><br><span class="line">        System.out.println(tc.evaluate(t));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>不要main，打包，放到hdfs所在机器上</p>
</li>
<li><p>跳到15那的Java示例1</p>
</li>
</ol>
<p>上传jar包到hdfs</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -<span class="built_in">mkdir</span> -p /func</span><br><span class="line">hdfs dfs -put /opt/timefunc-1.0-SNAPSHOT.jar /func</span><br></pre></td></tr></table></figure></div>

<p>在hive上使用hdfs上的jar包创建永久函数</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> timehandler <span class="keyword">as</span> <span class="string">&#x27;com.njupt.timefunc.TimeChange&#x27;</span> <span class="keyword">using</span> jar <span class="string">&#x27;hdfs://192.168.179.139:9000/func/timefunc-1.0-SNAPSHOT.jar&#x27;</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<h5 id="B-时间函数"><a href="#B-时间函数" class="headerlink" title="B.时间函数"></a>B.时间函数</h5><div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">除了mysql那些</span><br><span class="line">trunc剪切</span><br><span class="line">from_unixtime 从时间戳转日期时间</span><br></pre></td></tr></table></figure></div>

<h5 id="C-字符串"><a href="#C-字符串" class="headerlink" title="C.字符串"></a>C.字符串</h5><div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cast</span>(xxx <span class="keyword">as</span> <span class="type">int</span>) <span class="comment">-- 字符串转换</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/58.png"
                     
                ></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> regexp_extract(<span class="string">&#x27;zs 1999-12-15 football,pingpang&#x27;</span>,<span class="string">&#x27;[a-z]+ ([0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;) .*&#x27;</span>,<span class="number">1</span>) <span class="comment">-- 出1999-12-15</span></span><br></pre></td></tr></table></figure></div>

<h5 id="D-类型转换函数和数学函数"><a href="#D-类型转换函数和数学函数" class="headerlink" title="D.类型转换函数和数学函数"></a>D.类型转换函数和数学函数</h5><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/59.png"
                     
                ></p>
<h5 id="E-日期函数"><a href="#E-日期函数" class="headerlink" title="E.日期函数"></a>E.日期函数</h5><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/60.png"
                     
                ></p>
<p>季度quarter</p>
<ul>
<li><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45124566/article/details/128203740" >date_format的格式标签<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240720135343188.png"
                      alt="image-20240720135343188"
                ></p>
</li>
</ul>
<h5 id="G-条件函数"><a href="#G-条件函数" class="headerlink" title="G.条件函数"></a>G.条件函数</h5><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/61.png"
                     
                ></p>
<h5 id="H-聚合函数"><a href="#H-聚合函数" class="headerlink" title="H.聚合函数"></a>H.聚合函数</h5><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/56.png"
                     
                ></p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> json_tuple(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;zs&quot;,&quot;age&quot;:40&#125;&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,&quot;age&quot;) <span class="comment">-- json中一定要&quot;&quot;，但hive都可以，取出这两个值</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>一个小例子</p>
<p>log文件形如</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2024-07-19 10:30:19.313  INFO 21384 --- [http-nio-9090-exec-5] com.njupt.mydata.controller.DataCtrl     : &#123;&quot;name&quot;:&quot;zhangsanfeng&quot;,&quot;age&quot;:40&#125;</span><br><span class="line">2024-07-19 10:30:19.500  INFO 21384 --- [http-nio-9090-exec-6] com.njupt.mydata.controller.DataCtrl     : &#123;&quot;name&quot;:&quot;zhangsanfeng&quot;,&quot;age&quot;:40&#125;</span><br></pre></td></tr></table></figure></div>

<p>hive读取</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database md</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> md.exp1(</span><br><span class="line">    data string</span><br><span class="line">)</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/testdata/info.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> md.exp1</span><br><span class="line"><span class="keyword">select</span> json_tuple(regexp_extract(data,<span class="string">&#x27;^.* : (\\&#123;.*\\&#125;)$&#x27;</span>,<span class="number">1</span>),<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>) <span class="keyword">from</span> md.exp1 <span class="keyword">where</span> data rlike <span class="string">&#x27;^.* : \\&#123;.*\\&#125;$&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>结果</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/62.png"
                     
                ></p>
<p>也可以用Java</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240719112202360.png"
                      alt="image-20240719112202360"
                ></p>
</li>
</ul>
<h5 id="I-数组操作"><a href="#I-数组操作" class="headerlink" title="I.数组操作"></a>I.数组操作</h5><ul>
<li><code>array_contains(array,str)</code>str是否在array中</li>
<li>制作数组<code>array(&#39;str1&#39;,&#39;str2&#39;)</code></li>
</ul>
<h4 id="16-MapJoin"><a href="#16-MapJoin" class="headerlink" title="16.MapJoin"></a>16.MapJoin</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/51.png"
                     
                ></p>
<h4 id="17-排序"><a href="#17-排序" class="headerlink" title="17.排序"></a>17.排序</h4><ul>
<li><p>分类</p>
<p>全局排序（Order by）</p>
<p>每个MapReduce内部排序（Sort by）</p>
<p>分区排序（Distribute by）</p>
<p>先分桶再排序（Cluster by）</p>
</li>
<li><p>Order by</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/53.png"
                      style="zoom:67%;" 
                >

<p>不管怎么设置，order by最后一定只有一个reducer</p>
</li>
<li><p><strong>Sort by</strong>和<strong>Distribute by</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/54.png"
                     
                ></p>
<p>sort by是组内排序，因此要配合distribute by使用</p>
<p>distribute by相当于分区操作，默认使用hash</p>
<p>记得要提前设置reduce数量，否则默认为1，<code>set mapreduce.job.reduces=3</code>设置个数</p>
</li>
<li><p>cluster by</p>
<p>基本不用，局限太大。只能升序，而且分组和排序的字段只能同一个</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/55.png"
                      style="zoom:50%;" 
                ></li>
</ul>
<h4 id="18-自定义mapReduce数量"><a href="#18-自定义mapReduce数量" class="headerlink" title="18.自定义mapReduce数量"></a>18.自定义mapReduce数量</h4><h5 id="A-mapper"><a href="#A-mapper" class="headerlink" title="A.mapper"></a>A.mapper</h5><p><code>set mapred.max.split.size=204800</code>设置分块大小，可以决定mapper数量，默认128M，单位为B</p>
<h5 id="B-reducer"><a href="#B-reducer" class="headerlink" title="B.reducer"></a>B.reducer</h5><p><code>set mapreduce.job.reduces=3</code>设置个数</p>
<h4 id="19-单元格分组聚合"><a href="#19-单元格分组聚合" class="headerlink" title="19.单元格分组聚合"></a>19.单元格分组聚合</h4><p>相当于mysql中的group_concat。collect_set,collect_list</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/56.png"
                     
                ></p>
<p>从列直接聚合成一行，set是无序不可重复的，list是有序可重复</p>
<h4 id="20-Hive事务"><a href="#20-Hive事务" class="headerlink" title="20.Hive事务"></a>20.Hive事务</h4><p>有，但不太用，因为主要是select操作，默认是不开的</p>
<p>原子性（atomicity，或称不可分割性）、一致性（consistency）、隔离性（isolation，又称独立性）、持久性（durability）。</p>
<h4 id="21-Hive性能调优"><a href="#21-Hive性能调优" class="headerlink" title="21.Hive性能调优"></a>21.Hive性能调优</h4><ul>
<li><code>explain 语句</code>查看运行的过程</li>
<li>文件格式<ul>
<li>textfile  天生横向扫描</li>
<li>SequenceFile  把数据转为键值对，行格式，压缩比低，能直接看到切片效果，基本不用</li>
<li>ORCFILE <code>stored as orc</code> 压缩比高，行列存储，每个块都有索引，自带zlib和znappy压缩器，加载时性能消耗大</li>
<li>parquet，列式存储，存储嵌套式的数据</li>
</ul>
</li>
</ul>
<h4 id="22-Hive数据倾斜"><a href="#22-Hive数据倾斜" class="headerlink" title="22.Hive数据倾斜"></a>22.<a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/qingyunzong/p/8847597.html" >Hive数据倾斜<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></h4><p>​	<a href="./#Hive%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C.md">本地</a></p>
<h4 id="23-Java连接Hive"><a href="#23-Java连接Hive" class="headerlink" title="23.Java连接Hive"></a>23.Java连接Hive</h4><ul>
<li>不统计是不走mapReduce的</li>
<li>最后ADS中的内容就是要被调用而不被调用的</li>
</ul>
<h5 id="jdbc"><a href="#jdbc" class="headerlink" title="jdbc"></a>jdbc</h5><ul>
<li><p>加入的包</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>连接访问</p>
<p>jdbc</p>
<div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> Exception</span><br><span class="line">&#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;org.apache.hive.jdbc.HiveDriver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:hive2://192.168.179.139:10000/dws_supermark&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>); <span class="comment">// hive的用户名和密码</span></span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">pstat</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">&quot;select credit_type,count(1) num from dws_supermark.dws_customs group by credit_type order by num desc limit 5&quot;</span>);</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstat.executeQuery();</span><br><span class="line">    <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">        System.out.println(rs.getString(<span class="string">&quot;credit_type&quot;</span>)+<span class="string">&quot; &quot;</span>+rs.getInt(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    rs.close();</span><br><span class="line">    pstat.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h5 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h5><ul>
<li><p>导入包</p>
<p>前面选sql中的mybatis的驱动,再后面自己加</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> 这是个连接池</span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>配置application.yml</p>
<div class="code-container" data-rel="Yaml"><figure class="iseeu highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.apache.hive.jdbc.HiveDriver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:hive2://192.168.179.139:10000/ads_supermark_user</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">30000</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">validation-query:</span> <span class="string">select</span> <span class="number">1</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis.cfg.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:mapper/*.xml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>其他如后端框架mysql的连接</p>
</li>
</ul>
<h3 id="七-离线数仓四层结构"><a href="#七-离线数仓四层结构" class="headerlink" title="(七).离线数仓四层结构"></a>(七).离线数仓四层结构</h3><h4 id="自己总结的"><a href="#自己总结的" class="headerlink" title="自己总结的"></a>自己总结的</h4><ul>
<li>例子在上面14的一次练习中有</li>
</ul>
<ol>
<li><p>近源层</p>
<p>单纯映射表，ODS，Operational Data Store</p>
<p>进行数据的探索</p>
</li>
<li><p>数据明细层</p>
<p>DWD，Data Warehouse Detail，进行数据清理</p>
</li>
<li><p>数据服务层</p>
<p>DWS，Data Warehouse Summary</p>
<ul>
<li><p><strong>维度表</strong>：名词表，如用户、商品。</p>
<p>看一个事实的维度，用户表是交易表的维度表。</p>
</li>
<li><p><strong>事实表</strong>：动作表，如交易订单</p>
</li>
<li><p>可以进行一些数据的统计，做聚合等等</p>
</li>
<li><p>模型</p>
<p>星型模型，一个动作为中心，多维度查看。</p>
<p>雪花模型，从某个维度看维度再向事实</p>
<p>星座模型，多个维度看多个事实</p>
</li>
</ul>
</li>
<li><p>数据应用层</p>
<p>ADS，Application Data Store </p>
<p>把要查询的内容查完之后存在表中，做指标，后续外部调用就不要使用MapReduce了。</p>
<p>最后结果甚至可以存放在Mysql中，因为最后统计的数据量并不是很大，<strong>如果要做二次统计就放Mysql</strong></p>
</li>
<li><p>DWT层</p>
<p>如果是做指标的话，ADS层会换成DWT层</p>
</li>
</ol>
<ul>
<li><p>上面每一层都要有一个数据库</p>
<p>合起来称为数据仓库</p>
</li>
</ul>
<h4 id="后来讲的"><a href="#后来讲的" class="headerlink" title="后来讲的"></a>后来讲的</h4><h3 id="八-多次练习"><a href="#八-多次练习" class="headerlink" title="(八)多次练习"></a>(八)多次练习</h3><h4 id="1-某宝用户行为分析练习"><a href="#1-某宝用户行为分析练习" class="headerlink" title="1.某宝用户行为分析练习"></a>1.<a class="link"   target="_blank" rel="noopener" href="https://tianchi.aliyun.com/dataset/649" >某宝用户行为分析练习<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></h4><ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46525538/article/details/137242863" >https://blog.csdn.net/m0_46525538/article/details/137242863<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></li>
</ul>
<ol>
<li><p>创建数据仓库</p>
<p><code>create database taobao</code></p>
</li>
<li><p>创建数据表</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> taobao.userbehavior(</span><br><span class="line">    cust_id string,</span><br><span class="line">    sku_id string,</span><br><span class="line">    spu_id string,</span><br><span class="line">    useract string,</span><br><span class="line">    ts string</span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>导入数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/testdata/UserBehavior.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> taobao.userbehavior</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>数据探索</p>
<p><code>select * from taobao.userbehavior where cust_id not rlike &#39;^[0-9]+$&#39;</code></p>
</li>
<li><p>数据清理(分区表按日分，将时间戳改为YYYY-MM-DD HH:MM:SS)</p>
<ul>
<li><p>建立分区表，用orc的方式存储</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> taobao.behaviorpart(</span><br><span class="line">    cust_id string,</span><br><span class="line">    sku_id string,</span><br><span class="line">    spu_id string,</span><br><span class="line">    useract string,</span><br><span class="line">    actiondate string</span><br><span class="line">)</span><br><span class="line">partitioned <span class="keyword">by</span> (ymd string)</span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">stored <span class="keyword">as</span> orc</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>动态分区塞入数据</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- set hive.exec.dynamic.partition=true</span></span><br><span class="line"><span class="comment">-- set hive.exec.dynamic.partition.mode=nonstrict</span></span><br><span class="line"><span class="comment">-- insert into taobao.behaviorpart partition(ymd)</span></span><br><span class="line"><span class="comment">-- select t.*,date_format(actiondate,&#x27;yyyyMMdd&#x27;) ymd from (select ub.cust_id,ub.sku_id,ub.spu_id,ub.useract,from_unixtime(cast(ub.ts as int)) actiondate from taobao.userbehavior ub) t</span></span><br></pre></td></tr></table></figure></div>

<p>但是由于硬盘的原因受到限制，因此用静态分区，逐分区塞入数据</p>
</li>
<li><p>静态分区塞入数据，中间步骤用临时表缓解硬盘压力，删掉前面的表</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- alter table taobao.behaviorpart add partition(ymd=&#x27;20171125&#x27;) partition(ymd=&#x27;20171126&#x27;) </span></span><br><span class="line"><span class="comment">-- partition(ymd=&#x27;20171127&#x27;) partition(ymd=&#x27;20171128&#x27;) partition(ymd=&#x27;20171129&#x27;) </span></span><br><span class="line"><span class="comment">-- partition(ymd=&#x27;20171130&#x27;) partition(ymd=&#x27;20171201&#x27;) partition(ymd=&#x27;20171202&#x27;) partition(ymd=&#x27;20171203&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create table taobao.tmp1 like taobao.userbehavior</span></span><br><span class="line"><span class="comment">-- insert into taobao.tmp1 select ub.cust_id,ub.sku_id,ub.spu_id,ub.useract,from_unixtime(cast(ub.ts as int)) actiondate from taobao.userbehavior ub</span></span><br><span class="line"><span class="comment">-- drop table taobao.userbehavior</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> taobao.behaviorpart <span class="keyword">partition</span>(ymd<span class="operator">=</span><span class="string">&#x27;20171202&#x27;</span>) <span class="keyword">select</span> cust_id,sku_id,spu_id,useract,ts actiondate </span><br><span class="line"><span class="keyword">from</span> taobao.tmp1 <span class="keyword">where</span> date_format(ts,<span class="string">&#x27;yyyyMMdd&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;20171202&#x27;</span> <span class="comment">-- 一天天的导入</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
<li><p>成交率</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 成交率</span></span><br><span class="line"><span class="keyword">with</span></span><br><span class="line">t1 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> cust_id) total_num <span class="keyword">from</span> taobao.behaviorpart),</span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> cust_id) buy_num <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">where</span> useract<span class="operator">=</span><span class="string">&#x27;buy&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;成交率&#x27;</span> say,t2.buy_num<span class="operator">/</span>t1.total_num closerate <span class="keyword">from</span> t1 <span class="keyword">cross</span> <span class="keyword">join</span> t2</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>复购率</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 复购率</span></span><br><span class="line"><span class="keyword">with</span></span><br><span class="line">t1 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> cust_id) buy_num <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">where</span> useract<span class="operator">=</span><span class="string">&#x27;buy&#x27;</span>),</span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> cust_id <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">where</span> useract<span class="operator">=</span><span class="string">&#x27;buy&#x27;</span>),</span><br><span class="line">t3 <span class="keyword">as</span>(<span class="keyword">select</span> cust_id <span class="keyword">from</span> t2 <span class="keyword">group</span> <span class="keyword">by</span> cust_id <span class="keyword">having</span> <span class="built_in">count</span>(<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">1</span>),</span><br><span class="line">t4 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(cust_id) s <span class="keyword">from</span> t3)</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;复购率&#x27;</span> say,t4.s<span class="operator">/</span>t1.buy_num closerate <span class="keyword">from</span> t1 <span class="keyword">cross</span> <span class="keyword">join</span> t4</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>转化漏斗(点击-收藏&#x2F;加购-购买的数量关系)</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;pv&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) pv,<span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;fav&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) fav,</span><br><span class="line"><span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;cart&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) cart,<span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;buy&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) buy <span class="keyword">from</span> taobao.behaviorpart</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>跳失率(点击单页面即退出的用户&#x2F;全部点击用户数)</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span></span><br><span class="line">t1 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) dump_num <span class="keyword">from</span> (<span class="keyword">select</span> cust_id <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">where</span> useract<span class="operator">=</span><span class="string">&#x27;pv&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> cust_id <span class="keyword">having</span> <span class="built_in">count</span>(cust_id)<span class="operator">=</span><span class="number">1</span>) t),</span><br><span class="line">t2 <span class="keyword">as</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> cust_id) pv_total <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">where</span> useract<span class="operator">=</span><span class="string">&#x27;pv&#x27;</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;跳失率&#x27;</span> say,t1.dump_num<span class="operator">/</span>t2.pv_total lossrate <span class="keyword">from</span> t1 <span class="keyword">cross</span> <span class="keyword">join</span> t2</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>最活跃的用户Top10</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cust_id,<span class="built_in">count</span>(<span class="number">1</span>) active <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">group</span> <span class="keyword">by</span> cust_id <span class="keyword">order</span> <span class="keyword">by</span> active <span class="keyword">desc</span> limit <span class="number">10</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>最热门的商品Top10(浏览率最高的10个商品)</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sku_id,<span class="built_in">count</span>(<span class="number">1</span>) pv_num <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">where</span> useract<span class="operator">=</span><span class="string">&#x27;pv&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> sku_id <span class="keyword">order</span> <span class="keyword">by</span> pv_num <span class="keyword">desc</span> limit <span class="number">10</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>统计每天的用户量、点击量、收藏量、加购量、购买量</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> date_format(actiondate,<span class="string">&#x27;yyyy-MM-dd&#x27;</span>) addate,<span class="built_in">count</span>(<span class="keyword">distinct</span> cust_id) cnt_user,<span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;pv&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) cnt_pv,<span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;fav&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>))cnt_fav,<span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;cart&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) cnt_cart,<span class="built_in">count</span>(if(useract<span class="operator">=</span><span class="string">&#x27;buy&#x27;</span>,<span class="number">1</span>,<span class="keyword">null</span>)) cnt_buy <span class="keyword">from</span> taobao.behaviorpart <span class="keyword">group</span> <span class="keyword">by</span> date_format(actiondate,<span class="string">&#x27;yyyy-MM-dd&#x27;</span>)</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h4 id="2-较为真实的用户行为分析"><a href="#2-较为真实的用户行为分析" class="headerlink" title="2.较为真实的用户行为分析"></a>2.较为真实的用户行为分析</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240719142654641.png"
                      alt="image-20240719142654641"
                ></p>
<ul>
<li><p>要求：</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">customer_details.csv </span><br><span class="line">customer_id,first_name,last_name,email,gender,address,country,language,job,credit_type,credit_no</span><br><span class="line"></span><br><span class="line"> store_details.csv </span><br><span class="line">store_id,store_name,employee_number</span><br><span class="line"></span><br><span class="line"> store_review.csv </span><br><span class="line">transaction_id,store_id,review_score</span><br><span class="line"></span><br><span class="line"> transaction_details.csv </span><br><span class="line">transaction_id,customer_id,store_id,price,product,date,time</span><br><span class="line"></span><br><span class="line">Customer分析</span><br><span class="line">6.1找出顾客最常用的信用卡</span><br><span class="line">6.2找出客户资料中排名前五的职位名称</span><br><span class="line">6.3在美国女性最常用的信用卡</span><br><span class="line">6.4按性别和国家进行客户统计</span><br><span class="line"></span><br><span class="line">Transaction分析-1</span><br><span class="line">7.1计算每月总收入</span><br><span class="line">7.2计算每个季度的总收入</span><br><span class="line">7.3按年计算总收入</span><br><span class="line">7.4按工作日计算总收入</span><br><span class="line">7.5按时间段计算总收入(需要清理数据)</span><br><span class="line">7.6按时间段计算平均消费</span><br><span class="line">7.7按工作日计算平均消费</span><br><span class="line">7.8计算年、月、日的交易总数</span><br><span class="line">7.9找出交易量最大的10个客户</span><br><span class="line">7.10找出消费最多的前10位顾客</span><br><span class="line"></span><br><span class="line">Transaction分析-2</span><br><span class="line">7.11统计该期间交易数量最少的用户</span><br><span class="line">7.12计算每个季度的独立客户总数</span><br><span class="line">7.13计算每周的独立客户总数</span><br><span class="line">7.14计算整个活动客户平均花费的最大值</span><br><span class="line">7.15统计每月花费最多的客户</span><br><span class="line">7.16统计每月访问次数最多的客户</span><br><span class="line">7.17按总价找出最受欢迎的5种产品</span><br><span class="line">7.18根据购买频率找出最畅销的5种产品</span><br><span class="line">7.19根据客户数量找出最受欢迎的5种产品</span><br><span class="line">7.20验证前5个details</span><br><span class="line"></span><br><span class="line">Store分析</span><br><span class="line">8.1按客流量找出最受欢迎的商店</span><br><span class="line">8.2根据顾客消费价格找出最受欢迎的商店</span><br><span class="line">8.3根据顾客交易情况找出最受欢迎的商店</span><br><span class="line">8.4根据商店和唯一的顾客id获取最受欢迎的产品</span><br><span class="line">8.5获取每个商店的员工与顾客比</span><br><span class="line">8.6按年和月计算每家店的收入</span><br><span class="line">8.7按店铺制作总收益饼图</span><br><span class="line">8.8找出每个商店最繁忙的时间段</span><br><span class="line">8.9找出每家店的忠实顾客</span><br><span class="line">8.10根据每位员工的最高收入找出明星商店</span><br><span class="line"></span><br><span class="line">Review分析</span><br><span class="line">9.1在ext store review中找出存在冲突的交易映射关系</span><br><span class="line">9.2了解客户评价的覆盖率</span><br><span class="line">9.3根据评分了解客户的分布情况</span><br><span class="line">9.4根据交易了解客户的分布情况</span><br><span class="line">9.5客户给出的最佳评价是否总是同一家门店</span><br></pre></td></tr></table></figure></div>
</li>
<li></li>
</ul>
<h2 id="八-HBase"><a href="#八-HBase" class="headerlink" title="八.HBase"></a>八.HBase</h2><h3 id="（一）前期-1"><a href="#（一）前期-1" class="headerlink" title="（一）前期"></a>（一）前期</h3><ul>
<li>争议较大</li>
<li>NoSQL</li>
<li>目的是存储海量数据，在不启用MapReduce的情况下，快速查数据，列式存储</li>
<li>实时流的存储往往用HBase，是Hadoop原生的。Doris的好处是用sql，但存储能力和HBase差不多</li>
<li>鼓励冗余</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240720171300559.png"
                      alt="image-20240720171300559"
                ></li>
<li>比较昂贵，虽然效率高，但是用得人少</li>
<li>面试重点：<ul>
<li>Hbase行键是如何设计的</li>
<li>优化：预处理分析</li>
<li>热点问题</li>
<li>随机读写</li>
</ul>
</li>
<li>百亿数据必用，十亿左右可用可不用，适合PB级别的数据</li>
<li>hbase版本和hadoop有要求</li>
</ul>
<h3 id="（二）内容-1"><a href="#（二）内容-1" class="headerlink" title="（二）内容"></a>（二）内容</h3><h4 id="1-特点"><a href="#1-特点" class="headerlink" title="1.特点"></a>1.特点</h4><ul>
<li>数据访问速度快，响应时间约2-20毫秒</li>
<li>支持随机读写，每个节点20k~100k+ops&#x2F;s</li>
<li>可扩展性，可扩展到20,000+节点</li>
<li>高并发</li>
</ul>
<h4 id="2-应用场景"><a href="#2-应用场景" class="headerlink" title="2.应用场景"></a>2.应用场景</h4><ul>
<li>增量数据-时间序列数据<ul>
<li>高容量，高速写入</li>
<li>HBase之上有OpenTSDB模块，可以满足时序类场景<br>比如传感器，系统监控，股票行情监控等</li>
</ul>
</li>
<li>内容服务-Web后端应用<ul>
<li>Facebook和Alibaba</li>
<li>费用比较高</li>
</ul>
</li>
</ul>
<h4 id="3-随机存取"><a href="#3-随机存取" class="headerlink" title="3.随机存取"></a>3.随机存取</h4><ul>
<li><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722100316623.png"
                      alt="image-20240722100316623"
                ></p>
</li>
<li><p>列存储，列簇，就是多个列为一个列簇。如下图所示，基本信息、亲属就是列簇。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722101813403.png"
                      alt="image-20240722101813403"
                ></p>
<p>然后把每个列簇分出来，分成类似于多张表，但是这张表我们称为列簇，我们看上去仍然是一张表。中间的关联是用的行键（而不是主外键）。一个store就是一个列簇，一般最多两三个列簇</p>
</li>
<li><p>实际上的架构每行都为</p>
<p><code>行键 列簇 时间戳 列名 值</code></p>
<p>冗余性很高，但是通过稀疏索引可快速找到相应列，实现随机存取</p>
</li>
<li><p>物理架构</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722100504997.png"
                      alt="image-20240722100504997"
                ></p>
<p>StoreFile相当于是hdp中的block，对应一张表的一个列簇，一个Store相当于一张表，</p>
</li>
<li><p>行太多时，就分Region，多Region上下相连，才是完整的表</p>
</li>
<li><p>列太多时，分割成列簇，就是一个个StoreFile</p>
</li>
<li><p>MemStore是写入的缓冲区，达到容量条件或者时间要求会写入HDFS形成HFile</p>
</li>
<li><p>HLog（WAL）日志文件，因为MemStore在内存中，因此可能会导致丢失，先写入WAL，再放内存就可以还原了</p>
</li>
<li><p><a class="link"   target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1797288%E3%80%81" >https://cloud.tencent.com/developer/article/1797288、<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</li>
<li><p>HRegion分割是按hash，Store内部是按字典排序</p>
</li>
</ul>
<h3 id="（三）单机安装"><a href="#（三）单机安装" class="headerlink" title="（三）单机安装"></a>（三）单机安装</h3><ol>
<li><p>前提要有Hadoop</p>
</li>
<li><p>先安装zookeeper，zookeeper-3.4.5-cdh5.14.2.tar.gz放到<code>/opt</code></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -zxf zookeeper-3.4.5-cdh5.14.2.tar.gz</span><br><span class="line"><span class="built_in">mv</span> zookeeper-3.4.5-cdh5.14.2 soft/zk345</span><br><span class="line"><span class="built_in">cd</span> soft/zk345/conf/</span><br><span class="line"><span class="built_in">cp</span> zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure></div>

<p><code>vim zoo.cfg</code></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/opt/soft/zk345/data</span><br><span class="line">server.1=192.168.179.139:2888:3888</span><br></pre></td></tr></table></figure></div>

<p><code>vim /etc/profile</code></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Zookeeper Env</span></span><br><span class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/opt/soft/zk345</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZOOKEEPER_HOME</span>/bin</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment"># 在hadoop启动的情况下</span></span><br><span class="line">zkServer.sh start</span><br></pre></td></tr></table></figure></div>

<p>多个QuorumPeerMain</p>
</li>
<li><p>hbase安装，把hbase-1.2.0-cdh5.14.2.tar.gz放到<code>/opt</code>下</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">tar -zxf hbase-1.2.0-cdh5.14.2.tar.gz</span><br><span class="line"><span class="built_in">mv</span> hbase-1.2.0-cdh5.14.2 soft/hbase120</span><br><span class="line"><span class="built_in">cd</span> soft/hbase120/conf</span><br></pre></td></tr></table></figure></div>

<p><code>vim hbase-env.sh</code></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/soft/jdk180</span><br><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span> <span class="comment"># 用外部的zookeeper</span></span><br></pre></td></tr></table></figure></div>

<p><code>vim hbase-site.xml</code></p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://192.168.179.139:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">&lt;!—单机模式不需要配置，分布式配置此项为true,单机好像也得true--&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/soft/zk345/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>vim &#x2F;etc&#x2F;profile</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Hbase Env</span></span><br><span class="line"><span class="built_in">export</span> HBASE_HOME=/opt/soft/hbase120</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HBASE_HOME</span>/bin</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">start-hbase.sh</span><br><span class="line"><span class="comment"># 多出HRegionServer HMaseter</span></span><br><span class="line"><span class="comment"># 进入</span></span><br><span class="line">hbase shell</span><br><span class="line">stop-hbase.sh</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h3 id="（四）使用"><a href="#（四）使用" class="headerlink" title="（四）使用"></a>（四）使用</h3><h4 id="1-第一次使用-1"><a href="#1-第一次使用-1" class="headerlink" title="1.第一次使用"></a>1.第一次使用</h4><div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh start</span><br><span class="line">start-hbase.sh</span><br><span class="line"><span class="comment"># HRegionServer HMaseter</span></span><br><span class="line"><span class="comment"># 进入</span></span><br><span class="line">hbase shell</span><br><span class="line"><span class="comment"># 进入后</span></span><br><span class="line">list</span><br></pre></td></tr></table></figure></div>

<p>删除过程要<strong>按住ctrl删除</strong>，否则会往后删</p>
<h4 id="2-各种命令"><a href="#2-各种命令" class="headerlink" title="2.各种命令"></a>2.各种命令</h4><ul>
<li><p>命令集</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722103614849.png"
                      alt="image-20240722103614849"
                ></p>
</li>
<li><p>名空间(namespace)-对应数据库</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_namespace &#x27;名字&#x27;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>建表</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create &#x27;名空间:表名&#x27;,&#x27;列簇1&#x27;,&#x27;列簇2&#x27;...</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>插入数据</p>
<p>一次只能插入一格</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put &#x27;名空间:表名&#x27;,行键,&#x27;列簇名:列名&#x27;,&#x27;字符串数据&#x27;或者数字</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查看数据</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan &#x27;名空间:表名&#x27;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>结果 能看到有插入的时间戳</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722105216040.png"
                      alt="image-20240722105216040"
                ></p>
<ul>
<li><p>查单个</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get &#x27;名空间:表名&#x27;,行键</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>查前5行</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan &#x27;名空间:表名&#x27;,&#123;LIMIT=&gt;5&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
<li><p>修改 和插入一样，会直接覆盖</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put &#x27;名空间:表名&#x27;,行键,&#x27;列簇名:列名&#x27;,&#x27;字符串数据&#x27;或者数字</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>删除数据</p>
<ul>
<li><p>删一格</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete &#x27;名空间:表名&#x27;,行键,&#x27;列簇名:列名&#x27;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>删一行</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete &#x27;名空间:表名&#x27;,行键</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>删全部数据</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate &#x27;名空间:表名&#x27;</span><br></pre></td></tr></table></figure></div>


</li>
<li><p>删表</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">先关停表再删除</span><br><span class="line">disable &#x27;名空间:表名&#x27;</span><br><span class="line">drop &#x27;名空间:表名&#x27;</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
<li><p>统计数</p>
<p>每1000行统计一次，太慢</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count &#x27;名空间:表名&#x27;</span><br></pre></td></tr></table></figure></div>

<p>外部统计</p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase org.apache.hadoop.hbase.mapreduce.RowCounter <span class="string">&#x27;库:表&#x27;</span> [<span class="string">&#x27;outputfile&#x27;</span>]</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h4 id="3-外部导入数据"><a href="#3-外部导入数据" class="headerlink" title="3.外部导入数据"></a>3.外部导入数据</h4><ul>
<li><strong>csv文件不要表头</strong></li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722110228811.png"
                      alt="image-20240722110228811"
                ></p>
<div class="code-container" data-rel="Sh"><figure class="iseeu highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase org.apache.hadoop.hbase.mapreduce.ImportTsv \</span><br><span class="line">-Dimporttsv.separator=,  \</span><br><span class="line">-Dimporttsv.columns=<span class="string">&quot;HBASE_ROW_KEY,列簇名:列名,列簇名:列名......&quot;</span> \</span><br><span class="line">mydemo:userinfos file://csv文件绝对路径</span><br></pre></td></tr></table></figure></div>

<h4 id="4-第一次hive操作hbase"><a href="#4-第一次hive操作hbase" class="headerlink" title="4.第一次hive操作hbase"></a>4.第一次hive操作hbase</h4><ul>
<li><p>首先hbase中有一个表mydemo:userinfos，两个列簇：base和others</p>
</li>
<li><p>数据三列都在base中，分别为name,age,gender</p>
</li>
<li><p>并不是很好，只是对hbase做了映射，还是得走mapreduce而不会用hbase。因为hive直接读取了hbase在hdfs上的文件</p>
</li>
<li><p>hbase是用SequenceFile 的方式存储的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722141907855.png"
                      alt="image-20240722141907855"
                ></p>
</li>
<li><p>因此这个方式做离线数仓还行，用Java直接对client下命令比较好</p>
</li>
</ul>
<ol>
<li><p>用hive映射操作hbase表(insert select)</p>
 <div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database exp;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> exp.cutoms(</span><br><span class="line">    id string,</span><br><span class="line">    username string,</span><br><span class="line">    age <span class="type">int</span>,</span><br><span class="line">    sex string</span><br><span class="line">)</span><br><span class="line">STORED <span class="keyword">BY</span> <span class="string">&#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> SERDEPROPERTIES (</span><br><span class="line">  &quot;hbase.columns.mapping&quot; <span class="operator">=</span> &quot;:key,base:name,base:age,base:gender&quot;</span><br><span class="line">)</span><br><span class="line">TBLPROPERTIES (</span><br><span class="line">  &quot;hbase.table.name&quot; <span class="operator">=</span> &quot;mydemo:userinfos&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></div></li>
</ol>
<h4 id="5-Java控制hbase"><a href="#5-Java控制hbase" class="headerlink" title="5.Java控制hbase"></a>5.Java控制hbase</h4><ul>
<li>走的是hbase的底层，速度比hive快得多</li>
<li>项目名hivejdbc</li>
</ul>
<ol>
<li><p>导入依赖</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p>使用</p>
<p>&#x3D;&#x3D;<code>C:\Windows\System32\drivers\etc\hosts</code>加虚拟机的<code>ip 主机名</code>，否则读不到表&#x3D;&#x3D;</p>
<ul>
<li><p>读数据</p>
  <div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> HBaseConfiguration.create();</span><br><span class="line">        <span class="comment">// 设置zookeeper地址</span></span><br><span class="line">        config.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;192.168.179.139:2181&quot;</span>);</span><br><span class="line">        <span class="comment">// 开启hbase数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionFactory.createConnection(config);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接开启&quot;</span>+connection);</span><br><span class="line">        <span class="comment">// 读取数据</span></span><br><span class="line">        <span class="comment">// 找到你要操作的表</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(<span class="string">&quot;mydemo:userinfos&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找到表：&quot;</span>+table);</span><br><span class="line">        <span class="comment">// 拿数据</span></span><br><span class="line">        <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">        <span class="type">ResultScanner</span> <span class="variable">rss</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">        System.out.println(<span class="string">&quot;获得数据集合：&quot;</span>+rss);</span><br><span class="line">        <span class="keyword">for</span> (Result rs : rss) &#123;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(rs.getRow())+ <span class="string">&quot; &quot;</span>+</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(rs.getValue(<span class="string">&quot;base&quot;</span>.getBytes(),<span class="string">&quot;name&quot;</span>.getBytes()))+<span class="string">&quot; &quot;</span>+</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(rs.getValue(<span class="string">&quot;base&quot;</span>.getBytes(),<span class="string">&quot;age&quot;</span>.getBytes()))+<span class="string">&quot; &quot;</span>+</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(rs.getValue(<span class="string">&quot;base&quot;</span>.getBytes(),<span class="string">&quot;gender&quot;</span>.getBytes())));</span><br><span class="line">        &#125;</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>写数据</p>
<div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> HBaseConfiguration.create();</span><br><span class="line">        <span class="comment">// 设置zookeeper地址</span></span><br><span class="line">        config.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;192.168.179.139:2181&quot;</span>);</span><br><span class="line">        <span class="comment">// 开启hbase数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionFactory.createConnection(config);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接开启&quot;</span>+connection);</span><br><span class="line">        <span class="comment">// 读取数据</span></span><br><span class="line">        <span class="comment">// 找到你要操作的表</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(<span class="string">&quot;mydemo:users&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找到表：&quot;</span>+table);</span><br><span class="line">        <span class="comment">// 添加一条数据</span></span><br><span class="line"><span class="comment">//        Put put = new Put(&quot;1&quot;.getBytes());</span></span><br><span class="line"><span class="comment">//        put.addColumn(&quot;base&quot;.getBytes(), &quot;uname&quot;.getBytes(), &quot;zs&quot;.getBytes());</span></span><br><span class="line"><span class="comment">//        put.addColumn(&quot;base&quot;.getBytes(),&quot;age&quot;.getBytes(),&quot;20&quot;.getBytes());</span></span><br><span class="line"><span class="comment">//        put.addColumn(&quot;base&quot;.getBytes(),&quot;gender&quot;.getBytes(),&quot;男&quot;.getBytes());</span></span><br><span class="line"><span class="comment">//        table.put(put);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一次性添加1000条数据</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        List&lt;Put&gt; putss = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= <span class="number">1002</span>; i++) &#123;</span><br><span class="line">            <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>((<span class="string">&quot;&quot;</span>+i).getBytes());</span><br><span class="line">            put.addColumn(<span class="string">&quot;base&quot;</span>.getBytes(), <span class="string">&quot;uname&quot;</span>.getBytes(), (<span class="string">&quot;zs&quot;</span>+i).getBytes());</span><br><span class="line">            put.addColumn(<span class="string">&quot;base&quot;</span>.getBytes(),<span class="string">&quot;age&quot;</span>.getBytes(),(<span class="string">&quot;&quot;</span>+rand.nextInt(<span class="number">100</span>)).getBytes());</span><br><span class="line">            put.addColumn(<span class="string">&quot;base&quot;</span>.getBytes(),<span class="string">&quot;gender&quot;</span>.getBytes(),(i%<span class="number">2</span>==<span class="number">0</span>?<span class="string">&quot;男&quot;</span>:<span class="string">&quot;女&quot;</span>).getBytes());</span><br><span class="line">            putss.add(put);</span><br><span class="line">        &#125;</span><br><span class="line">        table.put(putss);</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ol>
<h4 id="6-Java不定长度批量插入"><a href="#6-Java不定长度批量插入" class="headerlink" title="6.Java不定长度批量插入"></a>6.Java不定长度批量插入</h4><ul>
<li><p>包和前面一样</p>
</li>
<li><p>用缓存的方式</p>
</li>
<li><p>包用高版本的，才有定时刷缓冲区</p>
<div class="code-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><pre><code class="java">package org.example;

import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.hbase.HBaseConfiguration;
import org.apache.hadoop.hbase.TableName;
import org.apache.hadoop.hbase.client.*;

import java.util.Random;

public class App1 &#123;
    public static void main(String[] args) throws Exception&#123;
        Configuration config = HBaseConfiguration.create();
        // 设置zookeeper地址
        config.set(&quot;hbase.zookeeper.quorum&quot;, &quot;192.168.179.139:2181&quot;);
        // 开启hbase数据库连接
        Connection connection = ConnectionFactory.createConnection(config);
        System.out.println(&quot;连接开启&quot;+connection);
        // 读取数据
        // 找到你要操作的表
        Table table = connection.getTable(TableName.valueOf(&quot;mydemo:users&quot;));
        System.out.println(&quot;找到表：&quot;+table);

        // 一次性添加1000条数据
        Random rand = new Random();
        // 准备一个特定的缓存对象
        BufferedMutatorParams bmp = new BufferedMutatorParams(TableName.valueOf(&quot;mydemo:users&quot;));
        bmp.writeBufferSize(1024*1024); // 设置当数据满1kb时就填充数据到hdfs
        bmp.setWriteBufferPeriodicFlushTimerTickMs(2000); // 设置如果缓存区没有填满 此时刷新时间到达也会触发写操作
        // bmp.setWriteBufferPeriodicFlushTimeoutMs(3000); 超时时间
        BufferedMutator bm = connection.getBufferedMutator(bmp);

        for (int i = 1; i &lt;= 34225; i++) &#123;
            Put put = new Put((&quot;&quot;+i).getBytes());
            put.addColumn(&quot;base&quot;.getBytes(), &quot;uname&quot;.getBytes(), (&quot;zs&quot;+i).getBytes());
            put.addColumn(&quot;base&quot;.getBytes(),&quot;age&quot;.getBytes(),(&quot;&quot;+rand.nextInt(100)).getBytes());
            put.addColumn(&quot;base&quot;.getBytes(),&quot;gender&quot;.getBytes(),(i%2==0?&quot;男&quot;:&quot;女&quot;).getBytes());
            put.addColumn(&quot;base&quot;.getBytes(),&quot;say&quot;.getBytes(),&quot;51CTO博客已为您找到关于java 设置指定时间运行的相关内容,包含IT学习相关文档代码介绍、相关教程视频课程,以及java 设置指定时间运行问答内容。更多java 设置指定时间运行&quot;.getBytes());
            bm.mutate(put);
        &#125;
//        bm.flush();
        bm.close();
        connection.close();
    &#125;
&#125;

<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### （五）进阶学习</span><br><span class="line"></span><br><span class="line">#### 1.Region管理</span><br><span class="line"></span><br><span class="line">- Region拆分</span><br><span class="line">  - 当一个Region大到一定程度，会进行分裂(split)</span><br><span class="line">  - HBase可以通过Region Split达到负载均衡</span><br><span class="line">  - Region默认大小10G</span><br><span class="line">- Region合并</span><br><span class="line">  - 如果删除了大量数据，很多Region变小，这时候分成多个Region就很浪费，可以把Region合并起来，Region的合并不是为了性能考虑，主要是出于维护的目的</span><br><span class="line">- Region的拆分要重计算row_key，所以动态分不好，事先分区比较好。即为***预分区***</span><br><span class="line"></span><br><span class="line">##### A.Region预分区</span><br><span class="line"></span><br><span class="line">- 将数据分布在多Region上，防止自动分区，默认10G，每个表2、3列簇。要设计Row_key，**默认是按照Ascii来的**</span><br><span class="line"></span><br><span class="line">- 创建预分区，三个数字四个区，|是124，因此比前面数字小于等于的都会在左边，并非是数字，而是字符</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
create &#39;mydemo:uuu&#39;,&#39;base&#39;,&#123;SPLITS=&gt;[&#39;0|&#39;,&#39;1|&#39;,&#39;2|&#39;]&#125;
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 插入一条数据</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
put &#39;mydemo:uuu&#39;,&#39;012356bds&#39;,&#39;base:name&#39;,&#39;zs&#39;
</code></pre>
<p>结果：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://pic1.sabthever.cn/Blog_Base_Resouces/bigdata/image-20240722174111986.png"
                      alt="image-20240722174111986"
                ></p>
</li>
</ul>
<h5 id="B-预分区Row-key设计"><a href="#B-预分区Row-key设计" class="headerlink" title="B.预分区Row_key设计"></a>B.<strong>预分区Row_key设计</strong></h5><ul>
<li>(防止数据热点)</li>
</ul>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> 大数据学习笔记2-Hive、Hbase</li>
        <li><strong>作者:</strong> Sabthever</li>
        <li><strong>创建于
                :</strong> 2025-02-17 10:39:34</li>
        
            <li>
                <strong>更新于
                    :</strong> 2025-10-09 16:14:31
            </li>
        
        <li>
            <strong>链接:</strong> https://sabthever.cn/2025/02/17/technology/bigdata/Hadoop2-Hive-Hbase/
        </li>
        <li>
            <strong>
                版权声明:
            </strong>
            

            
                本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Hadoop/">#Hadoop</a>&nbsp;
			</li>
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Hive/">#Hive</a>&nbsp;
			</li>
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Hbase/">#Hbase</a>&nbsp;
			</li>
			
			<li class="tag-item mx-0.5">
				<a href="/tags/Bigdata/">#Bigdata</a>&nbsp;
			</li>
			
		</ul>
		

		
  <div class="recommended-article px-2 sm:px-6 md:px-8">
   <div class="recommended-desktop">
    <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/2025/01/11/technology/bigdata/Hadoop1/" title="大数据学习笔记1-Hadoop" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="大数据学习笔记1-Hadoop" class="!max-w-none">
  <span class="title">大数据学习笔记1-Hadoop</span>
</a><a class="recommended-article-item" href="/2025/07/08/technology/bigdata/Hadoop4-Spark/" title="大数据学习笔记4-Spark" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="大数据学习笔记4-Spark" class="!max-w-none">
  <span class="title">大数据学习笔记4-Spark</span>
</a><a class="recommended-article-item" href="/2025/09/11/technology/bigdata/Hadoop5-%E7%A6%BB%E7%BA%BF%E9%A1%B9%E7%9B%AE/" title="大数据学习笔记5-离线项目学习" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="大数据学习笔记5-离线项目学习" class="!max-w-none">
  <span class="title">大数据学习笔记5-离线项目学习</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header text-xl md:text-3xl font-bold mt-10">
     <i aria-hidden="true"></i><span>推荐阅读</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/2025/01/11/technology/bigdata/Hadoop1/" title="大数据学习笔记1-Hadoop" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="大数据学习笔记1-Hadoop" class="!max-w-none">
  <span class="title">大数据学习笔记1-Hadoop</span>
</a><a class="recommended-article-item" href="/2025/07/08/technology/bigdata/Hadoop4-Spark/" title="大数据学习笔记4-Spark" rel="bookmark">
  <img src="/images/wallhaven-wqery6-light.webp" alt="大数据学习笔记4-Spark" class="!max-w-none">
  <span class="title">大数据学习笔记4-Spark</span>
</a></div>
   </div>
  </div>

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2025/02/17/technology/API%E8%B0%83%E7%94%A8/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">API调用(webhook/sdk)</span>
						<span class="post-nav-item">上一篇</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2025/01/20/technology/java/%E5%88%A9%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0AOP/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">利用注解实现AOP</span>
						<span class="post-nav-item">下一篇</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">目录</div>
		<div class="page-title">大数据学习笔记2-Hive、Hbase</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hadoop2"><span class="nav-text">Hadoop2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83-Hive"><span class="nav-text">七.Hive</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%89%8D%E6%9C%9F"><span class="nav-text">（一）前期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF"><span class="nav-text">什么是</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF%E5%92%8C%E7%89%B9%E7%82%B9"><span class="nav-text">优势和特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">工作原理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%86%85%E5%AE%B9"><span class="nav-text">（二）内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89hive%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-text">（三）hive安装配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89zeppelin%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-text">（四）zeppelin安装配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%BA%94%EF%BC%89%E4%BD%BF%E7%94%A8"><span class="nav-text">（五）使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8"><span class="nav-text">1.第一次使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-text">2.远程连接和使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-DataGrip%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="nav-text">3.DataGrip远程连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E5%85%AD%EF%BC%89%E8%AF%A6%E7%BB%86%E5%AD%A6%E4%B9%A0"><span class="nav-text">（六）详细学习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">1.数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-Hive%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">2.Hive数据结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="nav-text">3.数据库操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-text">4.表操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%86%85%E9%83%A8%E8%A1%A8"><span class="nav-text">创建内部表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%96%E9%83%A8%E8%A1%A8"><span class="nav-text">创建外部表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E5%88%86%E5%89%B2"><span class="nav-text">复杂类型分割</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%98%B6%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="nav-text">高阶建表语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="nav-text">创建临时表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%88%86%E5%89%B2%E9%97%AE%E9%A2%98"><span class="nav-text">数据表分割问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E8%A7%A3%E6%9E%90%E5%99%A8serde"><span class="nav-text">5.解析器serde</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="nav-text">6.内部结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E6%95%B0%E6%8D%AE%E8%A1%A8%E4%B8%8A%E9%94%81"><span class="nav-text">7.数据表上锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-%E8%A3%85%E8%BD%BD%E6%95%B0%E6%8D%AELOAD"><span class="nav-text">8.装载数据LOAD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-Hive%E5%88%86%E5%8C%BA%EF%BC%88Partition%EF%BC%89"><span class="nav-text">9.Hive分区（Partition）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-%E4%BB%8B%E7%BB%8D"><span class="nav-text">A.介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-%E9%9D%99%E6%80%81%E4%BE%8B%E5%AD%901"><span class="nav-text">B.静态例子1</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#C-%E5%8A%A8%E6%80%81%E4%BE%8B%E5%AD%901"><span class="nav-text">C.动态例子1</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-%E5%88%86%E6%A1%B6"><span class="nav-text">10.分桶</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">A.知识点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-%E4%BE%8B%E5%AD%901jp"><span class="nav-text">B.例子1jp</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#11-%E5%88%86%E5%8C%BA%E5%92%8C%E5%88%86%E6%A1%B6%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="nav-text">11.分区和分桶的不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-Hive%E8%A7%86%E5%9B%BE-View"><span class="nav-text">12.Hive视图(View)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-%E4%BB%8B%E7%BB%8D-1"><span class="nav-text">A.介绍</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-Hive%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="nav-text">13.Hive高级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-%E6%9F%A5%E8%AF%A2"><span class="nav-text">A.查询</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B"><span class="nav-text">B.</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c"><span class="nav-text">c.</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-%E4%B8%80%E6%AC%A1%E7%BB%83%E4%B9%A0"><span class="nav-text">14.一次练习</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-%E5%95%86%E5%BA%97%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90%E7%BB%83%E4%B9%A01-DOS"><span class="nav-text">A.商店销售分析练习1-DOS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-%E5%95%86%E5%BA%97%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90%E7%BB%83%E4%B9%A02-DWD"><span class="nav-text">B.商店销售分析练习2-DWD</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#C-%E5%95%86%E5%BA%97%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90%E7%BB%83%E4%B9%A03-DWS"><span class="nav-text">C.商店销售分析练习3-DWS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#D-%E5%95%86%E5%BA%97%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90%E7%BB%83%E4%B9%A03-ADS"><span class="nav-text">D.商店销售分析练习3-ADS</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#15-Hive%E5%87%BD%E6%95%B0%E5%92%8CJava"><span class="nav-text">15.Hive函数和Java</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-UDF"><span class="nav-text">A.UDF</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="nav-text">B.时间函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#C-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">C.字符串</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#D-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0%E5%92%8C%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="nav-text">D.类型转换函数和数学函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#E-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-text">E.日期函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#G-%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="nav-text">G.条件函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#H-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-text">H.聚合函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#I-%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C"><span class="nav-text">I.数组操作</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#16-MapJoin"><span class="nav-text">16.MapJoin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-%E6%8E%92%E5%BA%8F"><span class="nav-text">17.排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#18-%E8%87%AA%E5%AE%9A%E4%B9%89mapReduce%E6%95%B0%E9%87%8F"><span class="nav-text">18.自定义mapReduce数量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-mapper"><span class="nav-text">A.mapper</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-reducer"><span class="nav-text">B.reducer</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#19-%E5%8D%95%E5%85%83%E6%A0%BC%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="nav-text">19.单元格分组聚合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#20-Hive%E4%BA%8B%E5%8A%A1"><span class="nav-text">20.Hive事务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#21-Hive%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><span class="nav-text">21.Hive性能调优</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#22-Hive%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C"><span class="nav-text">22.Hive数据倾斜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#23-Java%E8%BF%9E%E6%8E%A5Hive"><span class="nav-text">23.Java连接Hive</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#jdbc"><span class="nav-text">jdbc</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#springboot"><span class="nav-text">springboot</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83-%E7%A6%BB%E7%BA%BF%E6%95%B0%E4%BB%93%E5%9B%9B%E5%B1%82%E7%BB%93%E6%9E%84"><span class="nav-text">(七).离线数仓四层结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%B7%B1%E6%80%BB%E7%BB%93%E7%9A%84"><span class="nav-text">自己总结的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8E%E6%9D%A5%E8%AE%B2%E7%9A%84"><span class="nav-text">后来讲的</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AB-%E5%A4%9A%E6%AC%A1%E7%BB%83%E4%B9%A0"><span class="nav-text">(八)多次练习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9F%90%E5%AE%9D%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90%E7%BB%83%E4%B9%A0"><span class="nav-text">1.某宝用户行为分析练习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%BE%83%E4%B8%BA%E7%9C%9F%E5%AE%9E%E7%9A%84%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90"><span class="nav-text">2.较为真实的用户行为分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB-HBase"><span class="nav-text">八.HBase</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E5%89%8D%E6%9C%9F-1"><span class="nav-text">（一）前期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%86%85%E5%AE%B9-1"><span class="nav-text">（二）内容</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%89%B9%E7%82%B9"><span class="nav-text">1.特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">2.应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%9A%8F%E6%9C%BA%E5%AD%98%E5%8F%96"><span class="nav-text">3.随机存取</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E5%8D%95%E6%9C%BA%E5%AE%89%E8%A3%85"><span class="nav-text">（三）单机安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BD%BF%E7%94%A8"><span class="nav-text">（四）使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8-1"><span class="nav-text">1.第一次使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%90%84%E7%A7%8D%E5%91%BD%E4%BB%A4"><span class="nav-text">2.各种命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%A4%96%E9%83%A8%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-text">3.外部导入数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E7%AC%AC%E4%B8%80%E6%AC%A1hive%E6%93%8D%E4%BD%9Chbase"><span class="nav-text">4.第一次hive操作hbase</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-Java%E6%8E%A7%E5%88%B6hbase"><span class="nav-text">5.Java控制hbase</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-Java%E4%B8%8D%E5%AE%9A%E9%95%BF%E5%BA%A6%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="nav-text">6.Java不定长度批量插入</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#B-%E9%A2%84%E5%88%86%E5%8C%BARow-key%E8%AE%BE%E8%AE%A1"><span class="nav-text">B.预分区Row_key设计</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%80%E5%90%8E"><span class="nav-text">最后</span></a>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Sabthever</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        共撰写了 38 篇文章
                    </span>
                    
                        <span>
                            共 91.1k 字
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">访问人数</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">总访问量</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
            <div class="customize-info my-1">本站所有内容完全免费！不得将本站内容用于商业或者非法用途！</div>
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	
	<div class="search-pop-overlay">
	<div class="popup search-popup">
		<div class="search-header">
			<span class="search-input-field-pre">
				<i class="fa-solid fa-keyboard"></i>
			</span>
			<div class="search-input-container">
				<input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="站内搜索您需要的内容..." spellcheck="false" type="search" class="search-input">
			</div>
			<span class="popup-btn-close">
				<i class="fa-solid fa-times"></i>
			</span>
		</div>
		<div id="search-result">
			<div id="no-result">
				<i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
			</div>
		</div>
	</div>
</div>
	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>



    
<script src="/js/build/tools/localSearch.js" type="module"></script>




    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>




    
<script src="/js/build/tools/runtime.js"></script>

    
<script src="/js/build/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>






    
<script src="/js/build/libs/minimasonry.min.js"></script>

    
<script src="/js/build/plugins/masonry.js" type="module"></script>




    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





    
<script src="/js/build/layouts/bookmarkNav.js" type="module"></script>


	
</body>

</html>